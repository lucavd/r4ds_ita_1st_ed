<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>12 Tidy data | R for Data Science - edizione italiana</title>
<meta name="author" content="Hadley Wickham e Garrett Grolemund">
<meta name="description" content="12.1 Introduzione  “Le famiglie felici sono tutte uguali; ogni famiglia infelice è infelice a modo suo”. — Leo Tolstoy  “Le serie di dati ordinate sono tutte uguali, ma ogni serie di dati...">
<meta name="generator" content="bookdown 0.27.2 with bs4_book()">
<meta property="og:title" content="12 Tidy data | R for Data Science - edizione italiana">
<meta property="og:type" content="book">
<meta property="og:url" content="http://it.r4ds.hadley.nz/tidy-data.html">
<meta property="og:image" content="http://it.r4ds.hadley.nz/cover.png">
<meta property="og:description" content="12.1 Introduzione  “Le famiglie felici sono tutte uguali; ogni famiglia infelice è infelice a modo suo”. — Leo Tolstoy  “Le serie di dati ordinate sono tutte uguali, ma ogni serie di dati...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="12 Tidy data | R for Data Science - edizione italiana">
<meta name="twitter:site" content="@lucavd">
<meta name="twitter:description" content="12.1 Introduzione  “Le famiglie felici sono tutte uguali; ogni famiglia infelice è infelice a modo suo”. — Leo Tolstoy  “Le serie di dati ordinate sono tutte uguali, ma ogni serie di dati...">
<meta name="twitter:image" content="http://it.r4ds.hadley.nz/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-115082821-1');
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Data Science - edizione italiana</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Benvenuto</a></li>
<li><a class="" href="introduzione.html"><span class="header-section-number">1</span> Introduzione</a></li>
<li class="book-part">Esplora</li>
<li><a class="" href="explore-intro.html"><span class="header-section-number">2</span> Introduzione</a></li>
<li><a class="" href="visualizzazione.html"><span class="header-section-number">3</span> Visualizzazione</a></li>
<li><a class="" href="workflow-basi.html"><span class="header-section-number">4</span> Workflow: basi</a></li>
<li><a class="" href="transform.html"><span class="header-section-number">5</span> Trasformazione</a></li>
<li><a class="" href="workflow-script.html"><span class="header-section-number">6</span> Workflow: script</a></li>
<li><a class="" href="analisi-esplorativa.html"><span class="header-section-number">7</span> Analisi esplorativa</a></li>
<li><a class="" href="workflow-progetti.html"><span class="header-section-number">8</span> Workflow: progetti</a></li>
<li class="book-part">Wrangle</li>
<li><a class="" href="wrangle-intro.html"><span class="header-section-number">9</span> Introduzione</a></li>
<li><a class="" href="tibble.html"><span class="header-section-number">10</span> Tibble</a></li>
<li><a class="" href="importazione-dei-dati.html"><span class="header-section-number">11</span> Importazione dei dati</a></li>
<li><a class="active" href="tidy-data.html"><span class="header-section-number">12</span> Tidy data</a></li>
<li><a class="" href="dati-relazionali.html"><span class="header-section-number">13</span> Dati relazionali</a></li>
<li><a class="" href="stringhe.html"><span class="header-section-number">14</span> Stringhe</a></li>
<li><a class="" href="fattori.html"><span class="header-section-number">15</span> Fattori</a></li>
<li><a class="" href="date-e-tempi.html"><span class="header-section-number">16</span> Date e tempi</a></li>
<li class="book-part">Programmare</li>
<li><a class="" href="program-intro.html"><span class="header-section-number">17</span> Introduzione</a></li>
<li><a class="" href="pipe.html"><span class="header-section-number">18</span> Pipe</a></li>
<li><a class="" href="funzioni.html"><span class="header-section-number">19</span> Funzioni</a></li>
<li><a class="" href="vettori.html"><span class="header-section-number">20</span> Vettori</a></li>
<li><a class="" href="iterazioni.html"><span class="header-section-number">21</span> Iterazioni</a></li>
<li class="book-part">Model</li>
<li><a class="" href="model-intro.html"><span class="header-section-number">22</span> Introduzione</a></li>
<li><a class="" href="modelli-base.html"><span class="header-section-number">23</span> Modelli base</a></li>
<li><a class="" href="costruire-modelli.html"><span class="header-section-number">24</span> Costruire modelli</a></li>
<li><a class="" href="molti-modelli.html"><span class="header-section-number">25</span> Molti modelli</a></li>
<li class="book-part">Comunicare</li>
<li><a class="" href="communicate-intro.html"><span class="header-section-number">26</span> Introduzione</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">27</span> R Markdown</a></li>
<li><a class="" href="grafici-per-la-comunicazione.html"><span class="header-section-number">28</span> Grafici per la comunicazione</a></li>
<li><a class="" href="formati-di-r-markdown.html"><span class="header-section-number">29</span> Formati di R Markdown</a></li>
<li><a class="" href="r-markdown-workflow.html"><span class="header-section-number">30</span> R Markdown workflow</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/lucavd/r4ds_ita_1st_ed">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidy-data" class="section level1">
<h1>
<span class="header-section-number">12</span> Tidy data<a class="anchor" aria-label="anchor" href="#tidy-data"><i class="fas fa-link"></i></a>
</h1>
<div id="introduzione-6" class="section level2">
<h2>
<span class="header-section-number">12.1</span> Introduzione<a class="anchor" aria-label="anchor" href="#introduzione-6"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>“Le famiglie felici sono tutte uguali; ogni famiglia infelice è infelice a modo suo”. — Leo Tolstoy</p>
</blockquote>
<blockquote>
<p>“Le serie di dati ordinate sono tutte uguali, ma ogni serie di dati disordinata è disordinata a modo suo”. — Hadley Wickham</p>
</blockquote>
<p>In questo capitolo, imparerete un modo coerente per organizzare i vostri dati in R, un’organizzazione chiamata <strong>tidy data</strong>. Mettere i vostri dati in questo formato richiede un po’ di lavoro iniziale, ma questo lavoro ripaga nel lungo termine. Una volta che avete dati ordinati e gli strumenti ordinati forniti dai pacchetti del tidyverse, passerete molto meno tempo a mescolare i dati da una rappresentazione all’altra, permettendovi di dedicare più tempo alle domande analitiche che avete a disposizione.</p>
<p>Questo capitolo vi darà un’introduzione pratica ai ‘tidy data’(dati ordinati, organizzati) e agli strumenti di accompagnamento nel pacchetto <strong>tidyr</strong>. Se volete saperne di più sulla teoria sottostante, potreste apprezzare il documento <em>Tidy Data</em> pubblicato nel Journal of Statistical Software, <a href="http://www.jstatsoft.org/v59/i10/paper" class="uri">http://www.jstatsoft.org/v59/i10/paper</a>.</p>
<div id="prerequisiti-6" class="section level3">
<h3>
<span class="header-section-number">12.1.1</span> Prerequisiti<a class="anchor" aria-label="anchor" href="#prerequisiti-6"><i class="fas fa-link"></i></a>
</h3>
<p>In questo capitolo ci concentreremo su tidyr, un pacchetto che fornisce una serie di strumenti per aiutare a riordinare i vostri insiemi di dati disordinati. tidyr è un membro del core tidyverse.</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="tidy-data-1" class="section level2">
<h2>
<span class="header-section-number">12.2</span> Tidy data<a class="anchor" aria-label="anchor" href="#tidy-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>È possibile rappresentare gli stessi dati sottostanti in più modi. L’esempio qui sotto mostra gli stessi dati organizzati in quattro modi diversi. Ogni set di dati mostra gli stessi valori di quattro variabili <em>paese</em>, <em>anno</em>, <em>popolazione</em>, e <em>casi</em>, ma ogni set di dati organizza i valori in un modo diverso.</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table1</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt;   country      year  cases population</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span>
<span><span class="va">table2</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 4</span></span>
<span><span class="co">#&gt;   country      year type           count</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999 cases            745</span></span>
<span><span class="co">#&gt; 2 Afghanistan  1999 population  19987071</span></span>
<span><span class="co">#&gt; 3 Afghanistan  2000 cases           2666</span></span>
<span><span class="co">#&gt; 4 Afghanistan  2000 population  20595360</span></span>
<span><span class="co">#&gt; 5 Brazil       1999 cases          37737</span></span>
<span><span class="co">#&gt; 6 Brazil       1999 population 172006362</span></span>
<span><span class="co">#&gt; # … with 6 more rows</span></span>
<span><span class="va">table3</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   country      year rate             </span></span>
<span><span class="co">#&gt; * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            </span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999 745/19987071     </span></span>
<span><span class="co">#&gt; 2 Afghanistan  2000 2666/20595360    </span></span>
<span><span class="co">#&gt; 3 Brazil       1999 37737/172006362  </span></span>
<span><span class="co">#&gt; 4 Brazil       2000 80488/174504898  </span></span>
<span><span class="co">#&gt; 5 China        1999 212258/1272915272</span></span>
<span><span class="co">#&gt; 6 China        2000 213766/1280428583</span></span>
<span></span>
<span><span class="co"># Distribuito su due tibble</span></span>
<span><span class="va">table4a</span>  <span class="co"># casi</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   country     `1999` `2000`</span></span>
<span><span class="co">#&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan    745   2666</span></span>
<span><span class="co">#&gt; 2 Brazil       37737  80488</span></span>
<span><span class="co">#&gt; 3 China       212258 213766</span></span>
<span><span class="va">table4b</span>  <span class="co"># popolazione</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   country         `1999`     `2000`</span></span>
<span><span class="co">#&gt; * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan   19987071   20595360</span></span>
<span><span class="co">#&gt; 2 Brazil       172006362  174504898</span></span>
<span><span class="co">#&gt; 3 China       1272915272 1280428583</span></span></code></pre></div>
<p>Sono tutte rappresentazioni degli stessi dati sottostanti, ma non sono ugualmente facili da usare. Un dataset, il dataset ordinato, sarà molto più facile da lavorare all’interno del tidyverse.</p>
<p>Ci sono tre regole correlate che rendono un dataset ordinato:</p>
<ol style="list-style-type: decimal">
<li>Ogni variabile deve avere la propria colonna.</li>
<li>Ogni osservazione deve avere la sua riga.</li>
<li>Ogni valore deve avere la propria cella.</li>
</ol>
<p>La figura <a href="tidy-data.html#fig:tidy-structure">12.1</a> mostra visivamente le regole.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tidy-structure"></span>
<img src="images/tidy-1.png" alt="Seguire tre regole rende un set di dati ordinato: le variabili sono nelle colonne, le osservazioni sono nelle righe e i valori sono nelle celle." width="100%"><p class="caption">
Figure 12.1: Seguire tre regole rende un set di dati ordinato: le variabili sono nelle colonne, le osservazioni sono nelle righe e i valori sono nelle celle.
</p>
</div>
<p>Queste tre regole sono interrelate perché è impossibile soddisfare solo due delle tre. Questa interrelazione porta ad un insieme ancora più semplice di istruzioni pratiche:</p>
<ol style="list-style-type: decimal">
<li>Metti ogni set di dati in una tibble.</li>
<li>Metti ogni variabile in una colonna.</li>
</ol>
<p>In questo esempio, solo la <code>table1</code> è ordinata. È l’unica rappresentazione in cui ogni colonna è una variabile.</p>
<p>Perché assicurarsi che i dati siano ordinati? Ci sono due vantaggi principali:</p>
<ol style="list-style-type: decimal">
<li><p>C’è un vantaggio generale nel scegliere un modo coerente di memorizzare
dati. Se hai una struttura di dati coerente, è più facile imparare gli
strumenti che lavorano con essa perché hanno un’uniformità di fondo.</p></li>
<li><p>C’è un vantaggio specifico nel mettere le variabili in colonne perché
permette alla natura vettoriale di R di brillare. Come avete imparato in
<a href="transform.html#mutate-funs">mutate</a> e <a href="transform.html#summary-funs">riassunti raggruppati</a>, la maggior parte
funzioni built-in di R lavorano con vettori di valori. Questo rende la trasformazione
dati ordinati in modo particolarmente naturale.</p></li>
</ol>
<p>dplyr, ggplot2 e tutti gli altri pacchetti del tidyverse sono progettati per lavorare con dati ordinati. Ecco un paio di piccoli esempi che mostrano come potreste lavorare con <code>table1</code>.</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calcolare il tasso per 10.000</span></span>
<span><span class="va">table1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="va">cases</span> <span class="op">/</span> <span class="va">population</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span><span class="co">#&gt;   country      year  cases population  rate</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999    745   19987071 0.373</span></span>
<span><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360 1.29 </span></span>
<span><span class="co">#&gt; 3 Brazil       1999  37737  172006362 2.19 </span></span>
<span><span class="co">#&gt; 4 Brazil       2000  80488  174504898 4.61 </span></span>
<span><span class="co">#&gt; 5 China        1999 212258 1272915272 1.67 </span></span>
<span><span class="co">#&gt; 6 China        2000 213766 1280428583 1.67</span></span>
<span></span>
<span><span class="co"># Calcolare i casi per anno</span></span>
<span><span class="va">table1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">year</span>, wt <span class="op">=</span> <span class="va">cases</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;    year      n</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  1999 250740</span></span>
<span><span class="co">#&gt; 2  2000 296920</span></span>
<span></span>
<span><span class="co"># Visualizzare i cambiamenti nel tempo</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">table1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidy_files/figure-html/unnamed-chunk-2-1.png" width="50%" style="display: block; margin: auto;"></div>
<div id="esercizi-23" class="section level3">
<h3>
<span class="header-section-number">12.2.1</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-23"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Usando la prosa, descrivete come sono organizzate le variabili e le osservazioni in
ciascuna delle tabelle di esempio.</p></li>
<li>
<p>Calcola il <code>rate</code> per la <code>table2</code>, e la <code>table4a</code> + <code>table4b</code>.
Dovrai eseguire quattro operazioni:</p>
<ol style="list-style-type: decimal">
<li>Estrarre il numero di casi di TBC per paese e per anno.</li>
<li>Estrarre la popolazione corrispondente per paese e per anno.</li>
<li>Dividere i casi per la popolazione e moltiplicare per 10000.</li>
<li>Memorizzare di nuovo nel posto appropriato.</li>
</ol>
<p>Quale rappresentazione è più facile da lavorare? Qual è la più difficile? Perché?</p>
</li>
<li><p>Ricreate il grafico che mostra il cambiamento dei casi nel tempo usando la <code>tabella2 invece di</code>table1`. Cosa devi fare per prima cosa?</p></li>
</ol>
</div>
</div>
<div id="pivoting" class="section level2">
<h2>
<span class="header-section-number">12.3</span> Pivoting<a class="anchor" aria-label="anchor" href="#pivoting"><i class="fas fa-link"></i></a>
</h2>
<p>I principi dei tidy data sembrano così ovvi che potreste chiedervi se incontrerete mai un set di dati che non sia ordinato. Sfortunatamente, però, la maggior parte dei dati che incontrerete saranno disordinati. Ci sono due ragioni principali:</p>
<ol style="list-style-type: decimal">
<li><p>La maggior parte delle persone non ha familiarità con i principi dei dati ordinati, ed è difficile
ricavarli da soli, a meno che non si passi molto tempo a lavorare con i dati.</p></li>
<li><p>I dati sono spesso organizzati per facilitare qualche uso diverso dall’analisi. Per
esempio, i dati sono spesso organizzati per rendere l’inserimento il più facile possibile.</p></li>
</ol>
<p>Questo significa che per la maggior parte delle analisi reali, dovrete fare un po’ di ordine. Il primo passo è sempre quello di capire quali sono le variabili e le osservazioni. A volte questo è facile; altre volte avrete bisogno di consultare le persone che hanno originariamente generato i dati.
Il secondo passo è quello di risolvere uno dei due problemi comuni:</p>
<ol style="list-style-type: decimal">
<li><p>Una variabile potrebbe essere distribuita su più colonne.</p></li>
<li><p>Un’osservazione potrebbe essere sparsa su più righe.</p></li>
</ol>
<p>Tipicamente un set di dati soffrirà solo di uno di questi problemi; soffrirà di entrambi solo se siete davvero sfortunati! Per risolvere questi problemi, avrete bisogno delle due funzioni più importanti di tidyr: <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> e <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>.</p>
<div id="longer" class="section level3">
<h3>
<span class="header-section-number">12.3.1</span> Longer<a class="anchor" aria-label="anchor" href="#longer"><i class="fas fa-link"></i></a>
</h3>
<p>Un problema comune è un dataset dove alcuni dei nomi delle colonne non sono nomi di variabili, ma <em>valori</em> di una variabile. Prendete la <code>table4a</code>: i nomi delle colonne <code>1999</code> e <code>2000</code> rappresentano i valori della variabile <code>year</code>, i valori nelle colonne <code>1999</code> e <code>2000</code> rappresentano i valori della variabile <code>cases</code>, e ogni riga rappresenta due osservazioni, non una.</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table4a</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   country     `1999` `2000`</span></span>
<span><span class="co">#&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan    745   2666</span></span>
<span><span class="co">#&gt; 2 Brazil       37737  80488</span></span>
<span><span class="co">#&gt; 3 China       212258 213766</span></span></code></pre></div>
<p>Per riordinare un set di dati come questo, abbiamo bisogno di <strong>pivot</strong> le colonne offensive in una nuova coppia di variabili. Per descrivere questa operazione abbiamo bisogno di tre parametri:</p>
<ul>
<li><p>L’insieme delle colonne i cui nomi sono valori, non variabili. In questo esempio,
queste sono le colonne <code>1999</code> e <code>2000</code>.</p></li>
<li><p>Il nome della variabile in cui spostare i nomi delle colonne. Qui è <code>year</code>.</p></li>
<li><p>Il nome della variabile in cui spostare i valori della colonna. Qui è <code>case</code>.</p></li>
</ul>
<p>Insieme questi parametri generano la chiamata a <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>:</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   country     year   cases</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan 1999     745</span></span>
<span><span class="co">#&gt; 2 Afghanistan 2000    2666</span></span>
<span><span class="co">#&gt; 3 Brazil      1999   37737</span></span>
<span><span class="co">#&gt; 4 Brazil      2000   80488</span></span>
<span><span class="co">#&gt; 5 China       1999  212258</span></span>
<span><span class="co">#&gt; 6 China       2000  213766</span></span></code></pre></div>
<p>Le colonne per fare il pivot sono specificate con la notazione in stile <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code>. Qui ci sono solo due colonne, quindi le elenchiamo singolarmente. Notate che “1999” e “2000” sono nomi non sintattici (perché non iniziano con una lettera), quindi dobbiamo circondarli di backtick. Per rinfrescarti la memoria sugli altri modi di selezionare le colonne, vedi <a href="transform.html#select">select</a>.</p>
<p><code>year</code> e <code>cases</code> non esistono in <code>table4a</code> quindi mettiamo i loro nomi tra virgolette.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tidy-gather"></span>
<img src="images/tidy-9.png" alt="Pivot di `table4` in forma 'long' e ordinata." width="100%"><p class="caption">
Figure 12.2: Pivot di <code>table4</code> in forma ‘long’ e ordinata.
</p>
</div>
<p>Nel risultato finale, le colonne pivotate vengono eliminate e si ottengono nuove colonne <code>year</code> e <code>cases</code>. Altrimenti, le relazioni tra le variabili originali sono conservate. Visivamente, questo è mostrato nella figura <a href="tidy-data.html#fig:tidy-gather">12.2</a>.</p>
<p>La funzione <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> rende i set di dati più lunghi aumentando il numero di righe e diminuendo il numero di colonne. Non credo che abbia senso descrivere un set di dati come se fosse in “forma lunga”. La lunghezza è un termine relativo, e si può solo dire (per esempio) che il dataset A è più lungo del dataset B.</p>
<p>Possiamo usare <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> per riordinare <code>table4b</code> in modo simile. L’unica differenza è la variabile memorizzata nei valori delle celle:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table4b</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   country     year  population</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan 1999    19987071</span></span>
<span><span class="co">#&gt; 2 Afghanistan 2000    20595360</span></span>
<span><span class="co">#&gt; 3 Brazil      1999   172006362</span></span>
<span><span class="co">#&gt; 4 Brazil      2000   174504898</span></span>
<span><span class="co">#&gt; 5 China       1999  1272915272</span></span>
<span><span class="co">#&gt; 6 China       2000  1280428583</span></span></code></pre></div>
<p>Per combinare le versioni riordinate di <code>table4a</code> e <code>table4b</code> in una singola tibble, dobbiamo usare <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::left_join()</a></code>, che imparerai in <a href="dati-relazionali.html#dati-relazionali">dati relazionali</a>.</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy4a</span> <span class="op">&lt;-</span> <span class="va">table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span></span>
<span><span class="va">tidy4b</span> <span class="op">&lt;-</span> <span class="va">table4b</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tidy4a</span>, <span class="va">tidy4b</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = c("country", "year")</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt;   country     year   cases population</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan 1999     745   19987071</span></span>
<span><span class="co">#&gt; 2 Afghanistan 2000    2666   20595360</span></span>
<span><span class="co">#&gt; 3 Brazil      1999   37737  172006362</span></span>
<span><span class="co">#&gt; 4 Brazil      2000   80488  174504898</span></span>
<span><span class="co">#&gt; 5 China       1999  212258 1272915272</span></span>
<span><span class="co">#&gt; 6 China       2000  213766 1280428583</span></span></code></pre></div>
</div>
<div id="wider" class="section level3">
<h3>
<span class="header-section-number">12.3.2</span> Wider<a class="anchor" aria-label="anchor" href="#wider"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> è l’opposto di <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. Si usa quando un’osservazione è sparsa su più righe. Per esempio, prendete la <code>table2</code>: un’osservazione è un paese in un anno, ma ogni osservazione è sparsa su due righe.</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table2</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 4</span></span>
<span><span class="co">#&gt;   country      year type           count</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999 cases            745</span></span>
<span><span class="co">#&gt; 2 Afghanistan  1999 population  19987071</span></span>
<span><span class="co">#&gt; 3 Afghanistan  2000 cases           2666</span></span>
<span><span class="co">#&gt; 4 Afghanistan  2000 population  20595360</span></span>
<span><span class="co">#&gt; 5 Brazil       1999 cases          37737</span></span>
<span><span class="co">#&gt; 6 Brazil       1999 population 172006362</span></span>
<span><span class="co">#&gt; # … with 6 more rows</span></span></code></pre></div>
<p>Per riordinare il tutto, analizziamo prima la rappresentazione in modo simile a <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. Questa volta, però, abbiamo bisogno solo di due parametri:</p>
<ul>
<li><p>La colonna da cui prendere i nomi delle variabili. Qui è <code>type</code>.</p></li>
<li><p>La colonna da cui prendere i valori. Qui è <code>count</code>.</p></li>
</ul>
<p>Una volta capito questo, possiamo usare <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>, come mostrato programmaticamente qui sotto, e visivamente nella figura <a href="tidy-data.html#fig:tidy-spread">12.3</a>.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">type</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt;   country      year  cases population</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tidy-spread"></span>
<img src="images/tidy-8.png" alt='Pivoting `table2` into a "wider", tidy form.' width="100%"><p class="caption">
Figure 12.3: Pivoting <code>table2</code> into a “wider”, tidy form.
</p>
</div>
<p>Come avrete capito dai loro nomi, <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> e <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> sono complementari. <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> rende le tabelle larghe più strette e lunghe; <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> rende le tabelle lunghe più corte e larghe.</p>
</div>
<div id="esercizi-24" class="section level3">
<h3>
<span class="header-section-number">12.3.3</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-24"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Perché i metodi <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> e <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> non sono perfettamente simmetrici?<br>
Considerate attentamente il seguente esempio:</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  year   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2015</span>, <span class="fl">2016</span>, <span class="fl">2016</span><span class="op">)</span>,</span>
<span>  half  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>   <span class="fl">1</span>,    <span class="fl">2</span>,     <span class="fl">1</span>,    <span class="fl">2</span><span class="op">)</span>,</span>
<span>  return <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">stocks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>, values_from <span class="op">=</span> <span class="va">return</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">`2015`</span><span class="op">:</span><span class="va">`2016`</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"return"</span><span class="op">)</span></span></code></pre></div>
<p>(Suggerimento: guardate i tipi di variabili e pensate ai <em>nomi</em> delle colonne).</p>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> ha un argomento <code>names_ptypes</code>, per esempio
<code>names_ptypes = list(year = double())</code>. Cosa fa?</p>
</li>
<li>
<p>Perché questo codice fallisce?</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1999</span>, <span class="fl">2000</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `loc_validate()`:</span></span>
<span><span class="co">#&gt; ! Can't subset columns past the end.</span></span>
<span><span class="co">#&gt; ℹ Locations 1999 and 2000 don't exist.</span></span>
<span><span class="co">#&gt; ℹ There are only 3 columns.</span></span></code></pre></div>
</li>
<li>
<p>Cosa succederebbe se allargassi questa tabella? Perché? Come potresti aggiungere una nuova colonna per identificare in modo univoco ogni valore?</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">people</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">name</span>,             <span class="op">~</span><span class="va">names</span>,  <span class="op">~</span><span class="va">values</span>,</span>
<span>  <span class="co">#-----------------|--------|------</span></span>
<span>  <span class="st">"Phillip Woods"</span>,   <span class="st">"age"</span>,       <span class="fl">45</span>,</span>
<span>  <span class="st">"Phillip Woods"</span>,   <span class="st">"height"</span>,   <span class="fl">186</span>,</span>
<span>  <span class="st">"Phillip Woods"</span>,   <span class="st">"age"</span>,       <span class="fl">50</span>,</span>
<span>  <span class="st">"Jessica Cordero"</span>, <span class="st">"age"</span>,       <span class="fl">37</span>,</span>
<span>  <span class="st">"Jessica Cordero"</span>, <span class="st">"height"</span>,   <span class="fl">156</span></span>
<span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p>Metti in ordine la semplice tibble qui sotto. Devi renderla più larga o più lunga, quali sono le variabili?</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">pregnant</span>, <span class="op">~</span><span class="va">male</span>, <span class="op">~</span><span class="va">female</span>,</span>
<span>  <span class="st">"yes"</span>,     <span class="cn">NA</span>,    <span class="fl">10</span>,</span>
<span>  <span class="st">"no"</span>,      <span class="fl">20</span>,    <span class="fl">12</span></span>
<span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
</div>
</div>
<div id="separare-e-unire" class="section level2">
<h2>
<span class="header-section-number">12.4</span> Separare e unire<a class="anchor" aria-label="anchor" href="#separare-e-unire"><i class="fas fa-link"></i></a>
</h2>
<p>Finora hai imparato come mettere in ordine <code>table2</code> e <code>table4</code>, ma non <code>table3</code>. La <code>table3</code> ha un problema diverso: abbiamo una colonna (<code>rate</code>) che contiene due variabili (<code>casi</code> e <code>popolazione</code>). Per risolvere questo problema, avremo bisogno della funzione <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>. Imparerete anche il complemento di <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>: <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code>, che si usa se una singola variabile è distribuita su più colonne.</p>
<div id="separare" class="section level3">
<h3>
<span class="header-section-number">12.4.1</span> Separare<a class="anchor" aria-label="anchor" href="#separare"><i class="fas fa-link"></i></a>
</h3>
<p>La funzione <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> separa una colonna in colonne multiple, dividendo ogni volta che appare un carattere separatore. Prendiamo ad esempio <code>table3</code>:</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   country      year rate             </span></span>
<span><span class="co">#&gt; * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            </span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999 745/19987071     </span></span>
<span><span class="co">#&gt; 2 Afghanistan  2000 2666/20595360    </span></span>
<span><span class="co">#&gt; 3 Brazil       1999 37737/172006362  </span></span>
<span><span class="co">#&gt; 4 Brazil       2000 80488/174504898  </span></span>
<span><span class="co">#&gt; 5 China        1999 212258/1272915272</span></span>
<span><span class="co">#&gt; 6 China        2000 213766/1280428583</span></span></code></pre></div>
<p>La colonna <code>rate</code> contiene entrambe le variabili <code>cases</code> e <code>population</code>, e abbiamo bisogno di dividerla in due variabili. La funzione <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> prende il nome della colonna da separare e i nomi delle colonne in cui separare, come mostrato nella figura <a href="tidy-data.html#fig:tidy-separate">12.4</a> e nel codice sottostante.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt;   country      year cases  population</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999 745    19987071  </span></span>
<span><span class="co">#&gt; 2 Afghanistan  2000 2666   20595360  </span></span>
<span><span class="co">#&gt; 3 Brazil       1999 37737  172006362 </span></span>
<span><span class="co">#&gt; 4 Brazil       2000 80488  174504898 </span></span>
<span><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tidy-separate"></span>
<img src="images/tidy-17.png" alt="Separating `table3` makes it tidy" width="75%"><p class="caption">
Figure 12.4: Separating <code>table3</code> makes it tidy
</p>
</div>
<p>Per default, <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> dividerà i valori ovunque veda un carattere non alfanumerico (cioè un carattere che non sia un numero o una lettera). Per esempio, nel codice qui sopra, <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> divide i valori di <code>rate</code> in corrispondenza dei caratteri ‘forward slash’. Se volete usare un carattere specifico per separare una colonna, potete passare il carattere all’argomento <code>sep</code> di <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>. Per esempio, potremmo riscrivere il codice sopra come:</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span></code></pre></div>
<p>(Formalmente, <code>sep</code> è un’espressione regolare, di cui imparerai di più in <a href="stringhe.html#stringhe">stringhe</a>).</p>
<p>Guardate attentamente i tipi di colonna: noterete che <code>cases</code> e <code>population</code> sono colonne di caratteri. Questo è il comportamento predefinito di <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>: lascia il tipo di colonna così com’è. Qui, tuttavia, non è molto utile, dato che sono davvero numeri. Possiamo chiedere a <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> di provare a convertire in tipi migliori usando <code>convert = TRUE</code>.:</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt;   country      year  cases population</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code></pre></div>
<p>Potete anche passare un vettore di interi a <code>sep</code>. <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> interpreterà gli interi come posizioni in cui dividere. I valori positivi partono da 1 all’estrema sinistra delle stringhe; i valori negativi partono da -1 all’estrema destra delle stringhe. Quando si usano gli interi per separare le stringhe, la lunghezza di <code>sep</code> dovrebbe essere inferiore al numero di nomi in <code>into</code>.</p>
<p>Puoi usare questa disposizione per separare le ultime due cifre di ogni anno. Questo rende questi dati meno ordinati, ma è utile in altri casi, come vedrai tra poco.</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">year</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"century"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt;   country     century year  rate             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            </span></span>
<span><span class="co">#&gt; 1 Afghanistan 19      99    745/19987071     </span></span>
<span><span class="co">#&gt; 2 Afghanistan 20      00    2666/20595360    </span></span>
<span><span class="co">#&gt; 3 Brazil      19      99    37737/172006362  </span></span>
<span><span class="co">#&gt; 4 Brazil      20      00    80488/174504898  </span></span>
<span><span class="co">#&gt; 5 China       19      99    212258/1272915272</span></span>
<span><span class="co">#&gt; 6 China       20      00    213766/1280428583</span></span></code></pre></div>
</div>
<div id="unite" class="section level3">
<h3>
<span class="header-section-number">12.4.2</span> Unite<a class="anchor" aria-label="anchor" href="#unite"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code>è l’inverso di <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>: combina colonne multiple in una singola colonna. Ti servirà molto meno frequentemente di <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>, ma è comunque uno strumento utile da avere in tasca.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tidy-unite"></span>
<img src="images/tidy-18.png" alt="Uniting `table5` makes it tidy" width="75%"><p class="caption">
Figure 12.5: Uniting <code>table5</code> makes it tidy
</p>
</div>
<p>Possiamo usare <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> per riunire le colonne <em>century</em> e <em>year</em> che abbiamo creato nell’ultimo esempio. Questi dati vengono salvati come <code><a href="https://tidyr.tidyverse.org/reference/table1.html">tidyr::table5</a></code>. <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> prende un data frame, il nome della nuova variabile da creare e un insieme di colonne da combinare, sempre specificate in stile <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code>:</p>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="va">new</span>, <span class="va">century</span>, <span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   country     new   rate             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            </span></span>
<span><span class="co">#&gt; 1 Afghanistan 19_99 745/19987071     </span></span>
<span><span class="co">#&gt; 2 Afghanistan 20_00 2666/20595360    </span></span>
<span><span class="co">#&gt; 3 Brazil      19_99 37737/172006362  </span></span>
<span><span class="co">#&gt; 4 Brazil      20_00 80488/174504898  </span></span>
<span><span class="co">#&gt; 5 China       19_99 212258/1272915272</span></span>
<span><span class="co">#&gt; 6 China       20_00 213766/1280428583</span></span></code></pre></div>
<p>In questo caso dobbiamo anche usare l’argomento <code>sep</code>. Il default metterà un underscore (<code>_</code>) tra i valori delle diverse colonne. Qui non vogliamo nessun separatore quindi usiamo <code>""</code>:</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="va">new</span>, <span class="va">century</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   country     new   rate             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            </span></span>
<span><span class="co">#&gt; 1 Afghanistan 1999  745/19987071     </span></span>
<span><span class="co">#&gt; 2 Afghanistan 2000  2666/20595360    </span></span>
<span><span class="co">#&gt; 3 Brazil      1999  37737/172006362  </span></span>
<span><span class="co">#&gt; 4 Brazil      2000  80488/174504898  </span></span>
<span><span class="co">#&gt; 5 China       1999  212258/1272915272</span></span>
<span><span class="co">#&gt; 6 China       2000  213766/1280428583</span></span></code></pre></div>
</div>
<div id="esercizi-25" class="section level3">
<h3>
<span class="header-section-number">12.4.3</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-25"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Cosa fanno gli argomenti <code>extra</code> e <code>fill</code> in <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>?
Sperimentate le varie opzioni per i seguenti due set di dati giocattolo.</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a,b,c"</span>, <span class="st">"d,e,f,g"</span>, <span class="st">"h,i,j"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a,b,c"</span>, <span class="st">"d,e"</span>, <span class="st">"f,g,i"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</li>
<li><p>Sia <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> che <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> hanno un argomento <code>remove</code>. Che cosa fa
fa? Perché dovreste impostarlo a <code>FALSE</code>?</p></li>
<li><p>Confrontate e contrapponete <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> e <code><a href="https://tidyr.tidyverse.org/reference/extract.html">extract()</a></code>. Perché ci sono
tre varianti di separazione (per posizione, per separatore e con
gruppi), ma solo una unite?</p></li>
</ol>
</div>
</div>
<div id="valori-mancanti-3" class="section level2">
<h2>
<span class="header-section-number">12.5</span> Valori mancanti<a class="anchor" aria-label="anchor" href="#valori-mancanti-3"><i class="fas fa-link"></i></a>
</h2>
<p>Cambiare la rappresentazione di un set di dati fa emergere un’importante sottigliezza sui valori mancanti. Sorprendentemente, un valore può essere mancante in uno dei due modi possibili:</p>
<ul>
<li>
<strong>Esplicitamente</strong>, cioè contrassegnato da <code>NA</code>.</li>
<li>
<strong>Implicitamente</strong>, cioè semplicemente non presente nei dati.</li>
</ul>
<p>Illustriamo questa idea con un insieme di dati molto semplice:</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  year   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2015</span>, <span class="fl">2015</span>, <span class="fl">2015</span>, <span class="fl">2016</span>, <span class="fl">2016</span>, <span class="fl">2016</span><span class="op">)</span>,</span>
<span>  qtr    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>   <span class="fl">1</span>,    <span class="fl">2</span>,    <span class="fl">3</span>,    <span class="fl">4</span>,    <span class="fl">2</span>,    <span class="fl">3</span>,    <span class="fl">4</span><span class="op">)</span>,</span>
<span>  return <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.35</span>,   <span class="cn">NA</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>, <span class="fl">2.66</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Ci sono due valori mancanti in questo set di dati:</p>
<ul>
<li><p>Il rendimento per il quarto trimestre del 2015 è esplicitamente mancante, perché
la cella dove dovrebbe essere il suo valore contiene invece <code>NA</code>.</p></li>
<li><p>Il rendimento per il primo trimestre del 2016 è implicitamente mancante, perché
semplicemente non appare nel set di dati.</p></li>
</ul>
<p>Un modo per pensare alla differenza è con questo koan zen: Un valore mancante esplicito è la presenza di un’assenza; un valore mancante implicito è l’assenza di una presenza.</p>
<p>Il modo in cui un set di dati è rappresentato può rendere espliciti i valori impliciti. Per esempio, possiamo rendere esplicito il valore mancante implicito mettendo gli anni nelle colonne:</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stocks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>, values_from <span class="op">=</span> <span class="va">return</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span><span class="co">#&gt;     qtr `2015` `2016`</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1   1.88  NA   </span></span>
<span><span class="co">#&gt; 2     2   0.59   0.92</span></span>
<span><span class="co">#&gt; 3     3   0.35   0.17</span></span>
<span><span class="co">#&gt; 4     4  NA      2.66</span></span></code></pre></div>
<p>Poiché questi valori mancanti espliciti potrebbero non essere importanti in altre rappresentazioni dei dati, potete impostare <code>values_drop_na = TRUE</code> in <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> per rendere impliciti i valori mancanti espliciti:</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stocks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>, values_from <span class="op">=</span> <span class="va">return</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`2015`</span>, <span class="va">`2016`</span><span class="op">)</span>, </span>
<span>    names_to <span class="op">=</span> <span class="st">"year"</span>, </span>
<span>    values_to <span class="op">=</span> <span class="st">"return"</span>, </span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;     qtr year  return</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1 2015    1.88</span></span>
<span><span class="co">#&gt; 2     2 2015    0.59</span></span>
<span><span class="co">#&gt; 3     2 2016    0.92</span></span>
<span><span class="co">#&gt; 4     3 2015    0.35</span></span>
<span><span class="co">#&gt; 5     3 2016    0.17</span></span>
<span><span class="co">#&gt; 6     4 2016    2.66</span></span></code></pre></div>
<p>Un altro importante strumento per rendere espliciti i valori mancanti nei dati ordinati è <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code>:</p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stocks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">qtr</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 3</span></span>
<span><span class="co">#&gt;    year   qtr return</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2015     1   1.88</span></span>
<span><span class="co">#&gt; 2  2015     2   0.59</span></span>
<span><span class="co">#&gt; 3  2015     3   0.35</span></span>
<span><span class="co">#&gt; 4  2015     4  NA   </span></span>
<span><span class="co">#&gt; 5  2016     1  NA   </span></span>
<span><span class="co">#&gt; 6  2016     2   0.92</span></span>
<span><span class="co">#&gt; # … with 2 more rows</span></span></code></pre></div>
<p><code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> prende un insieme di colonne e trova tutte le combinazioni uniche. Poi si assicura che il dataset originale contenga tutti quei valori, riempiendo i <code>NA</code> espliciti dove necessario.</p>
<p>C’è un altro importante strumento che dovreste conoscere per lavorare con i valori mancanti. A volte, quando una fonte di dati è stata usata principalmente per l’inserimento di dati, i valori mancanti indicano che il valore precedente dovrebbe essere portato avanti:</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="va">person</span>,           <span class="op">~</span> <span class="va">treatment</span>, <span class="op">~</span><span class="va">response</span>,</span>
<span>  <span class="st">"Derrick Whitmore"</span>, <span class="fl">1</span>,           <span class="fl">7</span>,</span>
<span>  <span class="cn">NA</span>,                 <span class="fl">2</span>,           <span class="fl">10</span>,</span>
<span>  <span class="cn">NA</span>,                 <span class="fl">3</span>,           <span class="fl">9</span>,</span>
<span>  <span class="st">"Katherine Burke"</span>,  <span class="fl">1</span>,           <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Potete riempire questi valori mancanti con <code><a href="https://tidyr.tidyverse.org/reference/fill.html">fill()</a></code>. Prende un insieme di colonne in cui volete che i valori mancanti siano sostituiti dal più recente valore non mancante (a volte chiamato ultima osservazione portata avanti).</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html">fill</a></span><span class="op">(</span><span class="va">person</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span><span class="co">#&gt;   person           treatment response</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Derrick Whitmore         1        7</span></span>
<span><span class="co">#&gt; 2 Derrick Whitmore         2       10</span></span>
<span><span class="co">#&gt; 3 Derrick Whitmore         3        9</span></span>
<span><span class="co">#&gt; 4 Katherine Burke          1        4</span></span></code></pre></div>
<div id="esercizi-26" class="section level3">
<h3>
<span class="header-section-number">12.5.1</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-26"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Confrontate e contrapponete gli argomenti di <code>fill</code> a <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> e <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code>.</p></li>
<li><p>Cosa fa l’argomento direction di <code><a href="https://tidyr.tidyverse.org/reference/fill.html">fill()</a></code>?</p></li>
</ol>
</div>
</div>
<div id="caso-di-studio" class="section level2">
<h2>
<span class="header-section-number">12.6</span> Caso di studio<a class="anchor" aria-label="anchor" href="#caso-di-studio"><i class="fas fa-link"></i></a>
</h2>
<p>Per finire il capitolo, mettiamo insieme tutto quello che abbiamo imparato per affrontare un realistico problema di riordino dei dati. Il dataset <code><a href="https://tidyr.tidyverse.org/reference/who.html">tidyr::who</a></code> contiene casi di tubercolosi (TB) suddivisi per anno, paese, età, sesso e metodo di diagnosi. I dati provengono dal <em>2014 World Health Organization Global Tuberculosis Report</em>, disponibile su <a href="http://www.who.int/tb/country/data/download/en/" class="uri">http://www.who.int/tb/country/data/download/en/</a>.</p>
<p>C’è una ricchezza di informazioni epidemiologiche in questo set di dati, ma è impegnativo lavorare con i dati nella forma in cui sono forniti:</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who</span></span>
<span><span class="co">#&gt; # A tibble: 7,240 × 60</span></span>
<span><span class="co">#&gt;   country   iso2  iso3   year new_sp_m014 new_sp_m1524 new_sp_m2534 new_sp_m3544</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt; &lt;int&gt;       &lt;int&gt;        &lt;int&gt;        &lt;int&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanis… AF    AFG    1980          NA           NA           NA           NA</span></span>
<span><span class="co">#&gt; 2 Afghanis… AF    AFG    1981          NA           NA           NA           NA</span></span>
<span><span class="co">#&gt; 3 Afghanis… AF    AFG    1982          NA           NA           NA           NA</span></span>
<span><span class="co">#&gt; 4 Afghanis… AF    AFG    1983          NA           NA           NA           NA</span></span>
<span><span class="co">#&gt; 5 Afghanis… AF    AFG    1984          NA           NA           NA           NA</span></span>
<span><span class="co">#&gt; 6 Afghanis… AF    AFG    1985          NA           NA           NA           NA</span></span>
<span><span class="co">#&gt; # … with 7,234 more rows, and 52 more variables: new_sp_m4554 &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   new_sp_m5564 &lt;int&gt;, new_sp_m65 &lt;int&gt;, new_sp_f014 &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   new_sp_f1524 &lt;int&gt;, new_sp_f2534 &lt;int&gt;, new_sp_f3544 &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   new_sp_f4554 &lt;int&gt;, new_sp_f5564 &lt;int&gt;, new_sp_f65 &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   new_sn_m014 &lt;int&gt;, new_sn_m1524 &lt;int&gt;, new_sn_m2534 &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   new_sn_m3544 &lt;int&gt;, new_sn_m4554 &lt;int&gt;, new_sn_m5564 &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   new_sn_m65 &lt;int&gt;, new_sn_f014 &lt;int&gt;, new_sn_f1524 &lt;int&gt;, …</span></span></code></pre></div>
<p>Questo è un tipico set di dati della vita reale. Contiene colonne ridondanti, codici variabili strani e molti valori mancanti. In breve, <code>who</code> è disordinato, e avremo bisogno di più passi per metterlo in ordine. Come dplyr, tidyr è progettato in modo che ogni funzione faccia bene una cosa. Questo significa che in situazioni reali avrete bisogno di mettere insieme più verbi in una pipeline.</p>
<p>Il posto migliore per iniziare è quasi sempre quello di riunire le colonne che non sono variabili. Diamo un’occhiata a quello che abbiamo:</p>
<ul>
<li><p>Sembra che <code>country</code>, <code>iso2</code> e <code>iso3</code> siano tre variabili che
specificano in modo ridondante il paese.</p></li>
<li><p>Anche <code>year</code> è chiaramente una variabile.</p></li>
<li><p>Non sappiamo ancora quali siano tutte le altre colonne, ma data la struttura
nei nomi delle variabili (es. <code>new_sp_m014</code>, <code>new_ep_m014</code>, <code>new_ep_f014</code>)
è probabile che questi siano valori, non variabili.</p></li>
</ul>
<p>Quindi abbiamo bisogno di raccogliere tutte le colonne da <code>new_sp_m014</code> a <code>newrel_f65</code>. Non sappiamo ancora cosa rappresentano questi valori, quindi daremo loro il nome generico di <code>"key"</code>. Sappiamo che le celle rappresentano il numero di casi, quindi useremo la variabile <code>cases</code>. Ci sono molti valori mancanti nella rappresentazione attuale, quindi per ora useremo <code>values_drop_na</code> solo per concentrarci sui valori che sono presenti.</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who1</span> <span class="op">&lt;-</span> <span class="va">who</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">new_sp_m014</span><span class="op">:</span><span class="va">newrel_f65</span>, </span>
<span>    names_to <span class="op">=</span> <span class="st">"key"</span>, </span>
<span>    values_to <span class="op">=</span> <span class="st">"cases"</span>, </span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">who1</span></span>
<span><span class="co">#&gt; # A tibble: 76,046 × 6</span></span>
<span><span class="co">#&gt;   country     iso2  iso3   year key          cases</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan AF    AFG    1997 new_sp_m014      0</span></span>
<span><span class="co">#&gt; 2 Afghanistan AF    AFG    1997 new_sp_m1524    10</span></span>
<span><span class="co">#&gt; 3 Afghanistan AF    AFG    1997 new_sp_m2534     6</span></span>
<span><span class="co">#&gt; 4 Afghanistan AF    AFG    1997 new_sp_m3544     3</span></span>
<span><span class="co">#&gt; 5 Afghanistan AF    AFG    1997 new_sp_m4554     5</span></span>
<span><span class="co">#&gt; 6 Afghanistan AF    AFG    1997 new_sp_m5564     2</span></span>
<span><span class="co">#&gt; # … with 76,040 more rows</span></span></code></pre></div>
<p>Possiamo avere qualche indizio sulla struttura dei valori nella nuova colonna “key” contandoli:</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 56 × 2</span></span>
<span><span class="co">#&gt;   key              n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 new_ep_f014   1032</span></span>
<span><span class="co">#&gt; 2 new_ep_f1524  1021</span></span>
<span><span class="co">#&gt; 3 new_ep_f2534  1021</span></span>
<span><span class="co">#&gt; 4 new_ep_f3544  1021</span></span>
<span><span class="co">#&gt; 5 new_ep_f4554  1017</span></span>
<span><span class="co">#&gt; 6 new_ep_f5564  1017</span></span>
<span><span class="co">#&gt; # … with 50 more rows</span></span></code></pre></div>
<p>Potresti essere in grado di analizzarlo da solo con un po’ di ragionamento e qualche esperimento, ma fortunatamente abbiamo il dizionario dei dati a portata di mano. Ci dice:</p>
<ol style="list-style-type: decimal">
<li><p>Le prime tre lettere di ogni colonna indicano se la colonna
contiene nuovi o vecchi casi di TBC. In questo set di dati, ogni colonna contiene
nuovi casi.</p></li>
<li>
<p>Le due lettere successive descrivono il tipo di TBC:</p>
<ul>
<li>
<code>rel</code> sta per i casi di ricaduta</li>
<li>
<code>ep</code> sta per i casi di TB extrapolmonare</li>
<li>
<code>sn</code> sta per i casi di TB polmonare che non possono essere diagnosticati da
uno striscio polmonare (striscio negativo)</li>
<li>
<code>sp</code> sta per i casi di TB polmonare che potrebbero essere diagnosticati da
uno striscio polmonare (striscio positivo)</li>
</ul>
</li>
<li><p>La sesta lettera indica il sesso dei pazienti con TB. Il dataset raggruppa
casi per maschi (<code>m</code>) e femmine (<code>f</code>).</p></li>
<li>
<p>I numeri rimanenti danno il gruppo di età. Il set di dati raggruppa i casi in
sette gruppi di età:</p>
<ul>
<li>
<code>014</code> = 0 – 14 anni</li>
<li>
<code>1524</code> = 15 – 24 anni</li>
<li>
<code>2534</code> = 25 – 34 anni</li>
<li>
<code>3544</code> = 35 – 44 anni</li>
<li>
<code>4554</code> = 45 – 54 anni</li>
<li>
<code>5564</code> = 55 – 64 anni</li>
<li>
<code>65</code> = 65 anni o più</li>
</ul>
</li>
</ol>
<p>Dobbiamo fare una piccola correzione al formato dei nomi delle colonne: sfortunatamente i nomi sono leggermente incoerenti perché invece di <code>new_rel</code> abbiamo <code>newrel</code> (è difficile da notare qui, ma se non lo correggi avremo degli errori nei passi successivi). Imparerai a conoscere <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code> in [strings], ma l’idea di base è abbastanza semplice: sostituisci i caratteri “newrel” con “new_rel”. Questo rende coerenti tutti i nomi delle variabili.</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who2</span> <span class="op">&lt;-</span> <span class="va">who1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>key <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">key</span>, <span class="st">"newrel"</span>, <span class="st">"new_rel"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">who2</span></span>
<span><span class="co">#&gt; # A tibble: 76,046 × 6</span></span>
<span><span class="co">#&gt;   country     iso2  iso3   year key          cases</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan AF    AFG    1997 new_sp_m014      0</span></span>
<span><span class="co">#&gt; 2 Afghanistan AF    AFG    1997 new_sp_m1524    10</span></span>
<span><span class="co">#&gt; 3 Afghanistan AF    AFG    1997 new_sp_m2534     6</span></span>
<span><span class="co">#&gt; 4 Afghanistan AF    AFG    1997 new_sp_m3544     3</span></span>
<span><span class="co">#&gt; 5 Afghanistan AF    AFG    1997 new_sp_m4554     5</span></span>
<span><span class="co">#&gt; 6 Afghanistan AF    AFG    1997 new_sp_m5564     2</span></span>
<span><span class="co">#&gt; # … with 76,040 more rows</span></span></code></pre></div>
<p>Possiamo separare i valori in ogni codice con due passaggi di <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>. Il primo passaggio dividerà i codici ad ogni trattino basso.</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who3</span> <span class="op">&lt;-</span> <span class="va">who2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">key</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"new"</span>, <span class="st">"type"</span>, <span class="st">"sexage"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">who3</span></span>
<span><span class="co">#&gt; # A tibble: 76,046 × 8</span></span>
<span><span class="co">#&gt;   country     iso2  iso3   year new   type  sexage cases</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan AF    AFG    1997 new   sp    m014       0</span></span>
<span><span class="co">#&gt; 2 Afghanistan AF    AFG    1997 new   sp    m1524     10</span></span>
<span><span class="co">#&gt; 3 Afghanistan AF    AFG    1997 new   sp    m2534      6</span></span>
<span><span class="co">#&gt; 4 Afghanistan AF    AFG    1997 new   sp    m3544      3</span></span>
<span><span class="co">#&gt; 5 Afghanistan AF    AFG    1997 new   sp    m4554      5</span></span>
<span><span class="co">#&gt; 6 Afghanistan AF    AFG    1997 new   sp    m5564      2</span></span>
<span><span class="co">#&gt; # … with 76,040 more rows</span></span></code></pre></div>
<p>Allora potremmo anche eliminare la colonna <code>new</code> perché è costante in questo set di dati. Mentre eliminiamo le colonne, eliminiamo anche <code>iso2</code> e <code>iso3</code> perché sono ridondanti.</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">new</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span><span class="co">#&gt;   new       n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 new   76046</span></span>
<span><span class="va">who4</span> <span class="op">&lt;-</span> <span class="va">who3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">new</span>, <span class="op">-</span><span class="va">iso2</span>, <span class="op">-</span><span class="va">iso3</span><span class="op">)</span></span></code></pre></div>
<p>Poi separeremo <code>sexage</code> in <code>sex</code> e <code>age</code> dividendo dopo il primo carattere:</p>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who5</span> <span class="op">&lt;-</span> <span class="va">who4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">sexage</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">who5</span></span>
<span><span class="co">#&gt; # A tibble: 76,046 × 6</span></span>
<span><span class="co">#&gt;   country      year type  sex   age   cases</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan  1997 sp    m     014       0</span></span>
<span><span class="co">#&gt; 2 Afghanistan  1997 sp    m     1524     10</span></span>
<span><span class="co">#&gt; 3 Afghanistan  1997 sp    m     2534      6</span></span>
<span><span class="co">#&gt; 4 Afghanistan  1997 sp    m     3544      3</span></span>
<span><span class="co">#&gt; 5 Afghanistan  1997 sp    m     4554      5</span></span>
<span><span class="co">#&gt; 6 Afghanistan  1997 sp    m     5564      2</span></span>
<span><span class="co">#&gt; # … with 76,040 more rows</span></span></code></pre></div>
<p>The <code>who</code> dataset is now tidy!</p>
<p>Vi ho mostrato il codice un pezzo alla volta, assegnando ogni risultato intermedio ad una nuova variabile. Questo tipicamente non è il modo in cui si lavora in modo interattivo. Invece, costruireste gradualmente un tubo complesso:</p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">new_sp_m014</span><span class="op">:</span><span class="va">newrel_f65</span>, </span>
<span>    names_to <span class="op">=</span> <span class="st">"key"</span>, </span>
<span>    values_to <span class="op">=</span> <span class="st">"cases"</span>, </span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    key <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">key</span>, <span class="st">"newrel"</span>, <span class="st">"new_rel"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">key</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"new"</span>, <span class="st">"var"</span>, <span class="st">"sexage"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">new</span>, <span class="op">-</span><span class="va">iso2</span>, <span class="op">-</span><span class="va">iso3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">sexage</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div id="esercizi-27" class="section level3">
<h3>
<span class="header-section-number">12.6.1</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-27"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>In questo caso di studio ho impostato <code>values_drop_na = TRUE</code> solo per rendere più facile
controllare che avessimo i valori corretti. È ragionevole? Pensate a
come sono rappresentati i valori mancanti in questo set di dati. Ci sono valori impliciti
valori mancanti? Qual è la differenza tra un <code>NA</code> e uno zero?</p></li>
<li><p>Cosa succede se trascurate il passo <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>?
(<code>mutate(names_from = stringr::str_replace(key, "newrel", "new_rel"))</code>)</p></li>
<li><p>Ho affermato che <code>iso2</code> e <code>iso3</code> sono ridondanti con <code>country</code>.
Confermate questa affermazione.</p></li>
<li><p>Per ogni paese, anno e sesso, calcola il numero totale di casi di
TBC. Fai una visualizzazione informativa dei dati.</p></li>
</ol>
</div>
</div>
<div id="dati-non-tidy" class="section level2">
<h2>
<span class="header-section-number">12.7</span> Dati non Tidy<a class="anchor" aria-label="anchor" href="#dati-non-tidy"><i class="fas fa-link"></i></a>
</h2>
<p>Prima di continuare con altri argomenti, vale la pena di parlare brevemente dei dati non ordinati. All’inizio del capitolo, ho usato il termine peggiorativo “disordinato” per riferirmi ai dati non ordinati. Questa è una semplificazione eccessiva: ci sono molte strutture di dati utili e ben fondate che non sono dati ordinati. Ci sono due ragioni principali per usare altre strutture di dati:</p>
<ul>
<li><p>Rappresentazioni alternative possono avere prestazioni sostanziali o vantaggi di spazio.
vantaggi di spazio.</p></li>
<li><p>I campi specializzati hanno sviluppato le proprie convenzioni per la memorizzazione dei dati
che possono essere molto diverse dalle convenzioni dei dati ordinati.</p></li>
</ul>
<p>Ognuno di questi motivi significa che avrete bisogno di qualcosa di diverso da un tibble (o data frame). Se i vostri dati si adattano naturalmente ad una struttura rettangolare composta da osservazioni e variabili, penso che tidy data dovrebbe essere la vostra scelta predefinita. Ma ci sono buone ragioni per usare altre strutture; i dati ordinati non sono l’unico modo.</p>
<p>Se volete saperne di più sui dati non ordinati, vi consiglio vivamente questo post sul blog di Jeff Leek: <a href="http://simplystatistics.org/2016/02/17/non-tidy-data/" class="uri">http://simplystatistics.org/2016/02/17/non-tidy-data/</a>.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="importazione-dei-dati.html"><span class="header-section-number">11</span> Importazione dei dati</a></div>
<div class="next"><a href="dati-relazionali.html"><span class="header-section-number">13</span> Dati relazionali</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidy-data"><span class="header-section-number">12</span> Tidy data</a></li>
<li>
<a class="nav-link" href="#introduzione-6"><span class="header-section-number">12.1</span> Introduzione</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#prerequisiti-6"><span class="header-section-number">12.1.1</span> Prerequisiti</a></li></ul>
</li>
<li>
<a class="nav-link" href="#tidy-data-1"><span class="header-section-number">12.2</span> Tidy data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#esercizi-23"><span class="header-section-number">12.2.1</span> Esercizi</a></li></ul>
</li>
<li>
<a class="nav-link" href="#pivoting"><span class="header-section-number">12.3</span> Pivoting</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#longer"><span class="header-section-number">12.3.1</span> Longer</a></li>
<li><a class="nav-link" href="#wider"><span class="header-section-number">12.3.2</span> Wider</a></li>
<li><a class="nav-link" href="#esercizi-24"><span class="header-section-number">12.3.3</span> Esercizi</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#separare-e-unire"><span class="header-section-number">12.4</span> Separare e unire</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#separare"><span class="header-section-number">12.4.1</span> Separare</a></li>
<li><a class="nav-link" href="#unite"><span class="header-section-number">12.4.2</span> Unite</a></li>
<li><a class="nav-link" href="#esercizi-25"><span class="header-section-number">12.4.3</span> Esercizi</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#valori-mancanti-3"><span class="header-section-number">12.5</span> Valori mancanti</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#esercizi-26"><span class="header-section-number">12.5.1</span> Esercizi</a></li></ul>
</li>
<li>
<a class="nav-link" href="#caso-di-studio"><span class="header-section-number">12.6</span> Caso di studio</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#esercizi-27"><span class="header-section-number">12.6.1</span> Esercizi</a></li></ul>
</li>
<li><a class="nav-link" href="#dati-non-tidy"><span class="header-section-number">12.7</span> Dati non Tidy</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/lucavd/r4ds_ita_1st_ed/blob/master/tidy.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/lucavd/r4ds_ita_1st_ed/edit/master/tidy.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Data Science - edizione italiana</strong>" was written by Hadley Wickham e Garrett Grolemund. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
