<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>21 Iterazioni | R for Data Science - edizione italiana</title>
<meta name="author" content="Hadley Wickham e Garrett Grolemund">
<meta name="description" content="21.1 Introduzione In funzioni, abbiamo parlato di quanto sia importante ridurre la duplicazione del codice creando funzioni invece di copiare e incollare. Ridurre la duplicazione del codice ha tre...">
<meta name="generator" content="bookdown 0.29.3 with bs4_book()">
<meta property="og:title" content="21 Iterazioni | R for Data Science - edizione italiana">
<meta property="og:type" content="book">
<meta property="og:url" content="http://it.r4ds.hadley.nz/iterazioni.html">
<meta property="og:image" content="http://it.r4ds.hadley.nz/cover.png">
<meta property="og:description" content="21.1 Introduzione In funzioni, abbiamo parlato di quanto sia importante ridurre la duplicazione del codice creando funzioni invece di copiare e incollare. Ridurre la duplicazione del codice ha tre...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="21 Iterazioni | R for Data Science - edizione italiana">
<meta name="twitter:site" content="@lucavd">
<meta name="twitter:description" content="21.1 Introduzione In funzioni, abbiamo parlato di quanto sia importante ridurre la duplicazione del codice creando funzioni invece di copiare e incollare. Ridurre la duplicazione del codice ha tre...">
<meta name="twitter:image" content="http://it.r4ds.hadley.nz/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0.9900/transition.js"></script><script src="libs/bs3compat-0.4.0.9900/tabs.js"></script><script src="libs/bs3compat-0.4.0.9900/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.1/str_view.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-115082821-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Data Science - edizione italiana</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Benvenuto</a></li>
<li><a class="" href="introduzione.html"><span class="header-section-number">1</span> Introduzione</a></li>
<li class="book-part">Esplora</li>
<li><a class="" href="explore-intro.html"><span class="header-section-number">2</span> Introduzione</a></li>
<li><a class="" href="visualizzazione.html"><span class="header-section-number">3</span> Visualizzazione</a></li>
<li><a class="" href="workflow-basi.html"><span class="header-section-number">4</span> Workflow: basi</a></li>
<li><a class="" href="transform.html"><span class="header-section-number">5</span> Trasformazione</a></li>
<li><a class="" href="workflow-script.html"><span class="header-section-number">6</span> Workflow: script</a></li>
<li><a class="" href="analisi-esplorativa.html"><span class="header-section-number">7</span> Analisi esplorativa</a></li>
<li><a class="" href="workflow-progetti.html"><span class="header-section-number">8</span> Workflow: progetti</a></li>
<li class="book-part">Wrangle</li>
<li><a class="" href="wrangle-intro.html"><span class="header-section-number">9</span> Introduzione</a></li>
<li><a class="" href="tibble.html"><span class="header-section-number">10</span> Tibble</a></li>
<li><a class="" href="importazione-dei-dati.html"><span class="header-section-number">11</span> Importazione dei dati</a></li>
<li><a class="" href="tidy-data.html"><span class="header-section-number">12</span> Tidy data</a></li>
<li><a class="" href="dati-relazionali.html"><span class="header-section-number">13</span> Dati relazionali</a></li>
<li><a class="" href="stringhe.html"><span class="header-section-number">14</span> Stringhe</a></li>
<li><a class="" href="fattori.html"><span class="header-section-number">15</span> Fattori</a></li>
<li><a class="" href="date-e-tempi.html"><span class="header-section-number">16</span> Date e tempi</a></li>
<li class="book-part">Programmare</li>
<li><a class="" href="program-intro.html"><span class="header-section-number">17</span> Introduzione</a></li>
<li><a class="" href="pipe.html"><span class="header-section-number">18</span> Pipe</a></li>
<li><a class="" href="funzioni.html"><span class="header-section-number">19</span> Funzioni</a></li>
<li><a class="" href="vettori.html"><span class="header-section-number">20</span> Vettori</a></li>
<li><a class="active" href="iterazioni.html"><span class="header-section-number">21</span> Iterazioni</a></li>
<li class="book-part">Model</li>
<li><a class="" href="model-intro.html"><span class="header-section-number">22</span> Introduzione</a></li>
<li><a class="" href="modelli-base.html"><span class="header-section-number">23</span> Modelli base</a></li>
<li><a class="" href="costruire-modelli.html"><span class="header-section-number">24</span> Costruire modelli</a></li>
<li><a class="" href="molti-modelli.html"><span class="header-section-number">25</span> Molti modelli</a></li>
<li class="book-part">Comunicare</li>
<li><a class="" href="communicate-intro.html"><span class="header-section-number">26</span> Introduzione</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">27</span> R Markdown</a></li>
<li><a class="" href="grafici-per-la-comunicazione.html"><span class="header-section-number">28</span> Grafici per la comunicazione</a></li>
<li><a class="" href="formati-di-r-markdown.html"><span class="header-section-number">29</span> Formati di R Markdown</a></li>
<li><a class="" href="r-markdown-workflow.html"><span class="header-section-number">30</span> R Markdown workflow</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/lucavd/r4ds_ita_1st_ed">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="iterazioni" class="section level1" number="21">
<h1>
<span class="header-section-number">21</span> Iterazioni<a class="anchor" aria-label="anchor" href="#iterazioni"><i class="fas fa-link"></i></a>
</h1>
<div id="introduzione-14" class="section level2" number="21.1">
<h2>
<span class="header-section-number">21.1</span> Introduzione<a class="anchor" aria-label="anchor" href="#introduzione-14"><i class="fas fa-link"></i></a>
</h2>
<p>In <a href="funzioni.html#funzioni">funzioni</a>, abbiamo parlato di quanto sia importante ridurre la duplicazione del codice creando funzioni invece di copiare e incollare. Ridurre la duplicazione del codice ha tre benefici principali:</p>
<ol style="list-style-type: decimal">
<li><p>È più facile vedere l’intento del vostro codice, perché i vostri occhi sono
attratti da ciò che è diverso, non da ciò che rimane lo stesso.</p></li>
<li><p>È più facile rispondere ai cambiamenti dei requisiti. Quando i tuoi bisogni
esigenze, hai solo bisogno di fare cambiamenti in un posto, piuttosto che
ricordarsi di cambiare ogni posto in cui hai copiato e incollato il
codice.</p></li>
<li><p>È probabile che abbiate meno bug perché ogni linea di codice è
usata in più posti.</p></li>
</ol>
<p>Uno strumento per ridurre la duplicazione sono le funzioni, che riducono la duplicazione identificando schemi ripetuti di codice e li estraggono in pezzi indipendenti che possono essere facilmente riutilizzati e aggiornati. Un altro strumento per ridurre la duplicazione è l’ <strong>iterazione</strong>, che vi aiuta quando avete bisogno di fare la stessa cosa a più input: ripetere la stessa operazione su diverse colonne, o su diversi insiemi di dati.
In questo capitolo imparerete due importanti paradigmi di iterazione: la programmazione imperativa e la programmazione funzionale. Sul lato imperativo ci sono strumenti come i cicli for e i cicli while, che sono un ottimo punto di partenza perché rendono l’iterazione molto esplicita, quindi è ovvio cosa sta succedendo. Tuttavia, i cicli for sono abbastanza prolissi e richiedono un bel po’ di codice di supporto che viene duplicato per ogni ciclo for. La programmazione funzionale (FP) offre strumenti per estrarre questo codice duplicato, così ogni comune modello di ciclo for ha la sua propria funzione. Una volta che si padroneggia il vocabolario della FP, si possono risolvere molti problemi comuni di iterazione con meno codice, più facilità e meno errori.</p>
<div id="prerequisiti-14" class="section level3" number="21.1.1">
<h3>
<span class="header-section-number">21.1.1</span> Prerequisiti<a class="anchor" aria-label="anchor" href="#prerequisiti-14"><i class="fas fa-link"></i></a>
</h3>
<p>Una volta che avete padroneggiato i cicli for forniti da R base, imparerete alcuni dei potenti strumenti di programmazione forniti da purrr, uno dei pacchetti principali di tidyverse.</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="cicli-for" class="section level2" number="21.2">
<h2>
<span class="header-section-number">21.2</span> Cicli for<a class="anchor" aria-label="anchor" href="#cicli-for"><i class="fas fa-link"></i></a>
</h2>
<p>Immaginiamo di avere questa semplice tibble:</p>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Vogliamo calcolare la mediana di ogni colonna. Si <em>potrebbe</em> fare con il copia-e-incolla:</p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.2457625</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.2873072</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">c</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.05669771</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1442633</span></span></code></pre></div>
<p>Ma questo infrange la nostra regola empirica: mai copiare e incollare più di due volte. Invece, potremmo usare un ciclo for:</p>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 1. output</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>            <span class="co"># 2. sequenza</span></span>
<span>  <span class="va">output</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>      <span class="co"># 3. corpo</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output</span></span>
<span><span class="co">#&gt; [1] -0.24576245 -0.28730721 -0.05669771  0.14426335</span></span></code></pre></div>
<p>Ogni ciclo for ha tre componenti:</p>
<ol style="list-style-type: decimal">
<li>
<p>Il <strong>output</strong>: <code>output &lt;- vector("double", length(x))</code>.
Prima di iniziare il ciclo, dovete sempre allocare uno spazio sufficiente
per l’output. Questo è molto importante per l’efficienza: se fate crescere
il ciclo for ad ogni iterazione usando <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> (per esempio), il vostro ciclo for
sarà molto lento.</p>
<p>Un modo generale per creare un vettore vuoto di una data lunghezza è la funzione <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code>
è la funzione <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code>. Ha due argomenti: il tipo di vettore (“logico”,
“intero”, “doppio”, “carattere”, ecc.) e la lunghezza del vettore.</p>
</li>
<li>
<p>La <strong>sequenza</strong>: <code>i in seq_along(df)</code>. Questo determina su cosa eseguire il ciclo:
ogni esecuzione del ciclo for assegnerà a <code>i</code> un valore diverso da
<code>seq_along(df)</code>. È utile pensare a <code>i</code> come a un pronome, come “it”.</p>
<p>Potreste non aver visto <code><a href="https://rdrr.io/r/base/seq.html">seq_along()</a></code> prima. È una versione sicura del
familiare <code>1:length(l)</code>, con un’importante differenza: se avete un
vettore di lunghezza zero, <code><a href="https://rdrr.io/r/base/seq.html">seq_along()</a></code> fa la cosa giusta:</p>
<div class="sourceCode" id="cb542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 0</span></span></code></pre></div>
<p>Probabilmente non creerete deliberatamente un vettore di lunghezza zero, ma
è facile crearli accidentalmente. Se usate <code>1:length(x)</code> invece di
di <code>seq_along(x)</code>, probabilmente otterrete un messaggio di errore confuso.</p>
</li>
<li><p>Il <strong>corpo</strong>: <code>output[[i]] &lt;- mediana(df[[i]])</code>. Questo è il codice che fa
il lavoro. Viene eseguito ripetutamente, ogni volta con un valore diverso per <code>i</code>.
La prima iterazione eseguirà <code>output[[1]] &lt;- mediana(df[[1]])</code>,
la seconda eseguirà <code>output[[2]] &lt;- mediana(df[[2]])</code>, e così via.</p></li>
</ol>
<p>Questo è tutto quello che c’è nel ciclo for! Ora è un buon momento per fare pratica nel creare alcuni cicli for di base (e non così di base) usando gli esercizi qui sotto. Poi passeremo ad alcune variazioni del ciclo for che vi aiuteranno a risolvere altri problemi che si presenteranno nella pratica.</p>
<div id="esercizi-58" class="section level3" number="21.2.1">
<h3>
<span class="header-section-number">21.2.1</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-58"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Scrivere cicli for per:</p>
<ol style="list-style-type: decimal">
<li>Calcolare la media di ogni colonna in <code>mtcars</code>.</li>
<li>Determinare il tipo di ogni colonna in <code><a href="https://rdrr.io/pkg/nycflights13/man/flights.html">nycflights13::flights</a></code>.</li>
<li>Calcolare il numero di valori unici in ogni colonna di <code>iris</code>.</li>
<li>Genera 10 normali casuali da distribuzioni con medie di -10, 0, 10 e 100.</li>
</ol>
<p>Pensate all’output, alla sequenza e al corpo <strong>prima</strong> di iniziare a scrivere
il ciclo.</p>
</li>
<li>
<p>Eliminate il ciclo for in ognuno dei seguenti esempi sfruttando
sfruttando una funzione esistente che lavora con i vettori:</p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">letters</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sd</span> <span class="op">&lt;-</span> <span class="va">sd</span> <span class="op">+</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">sd</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"numeric"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">out</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
<li>
<p>Combinate le vostre abilità di scrittura di funzioni e di ciclo for:</p>
<ol style="list-style-type: decimal">
<li><p>Scrivi un ciclo for che <code>stampi()</code> il testo della canzone per bambini
“Alice il cammello”.</p></li>
<li><p>Converti la filastrocca “dieci nel letto” in una funzione. Generalizzare
a qualsiasi numero di persone in qualsiasi struttura per dormire.</p></li>
<li><p>Convertire la canzone “99 bottiglie di birra sul muro” in una funzione.
Generalizzare a qualsiasi numero di qualsiasi recipiente contenente qualsiasi liquido su
qualsiasi superficie.</p></li>
</ol>
</li>
<li>
<p>È comune vedere cicli for che non preallocano l’output e invece
aumentano la lunghezza di un vettore ad ogni passo:</p>
<div class="sourceCode" id="cb544"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"integer"</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">output</span>, <span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output</span></span></code></pre></div>
<p>Come influisce sulle prestazioni? Progettate ed eseguite un esperimento.</p>
</li>
</ol>
</div>
</div>
<div id="variazioni-del-ciclo-for" class="section level2" number="21.3">
<h2>
<span class="header-section-number">21.3</span> Variazioni del ciclo for<a class="anchor" aria-label="anchor" href="#variazioni-del-ciclo-for"><i class="fas fa-link"></i></a>
</h2>
<p>Una volta che avete il ciclo for di base sotto la vostra cintura, ci sono alcune variazioni di cui dovreste essere consapevoli. Queste variazioni sono importanti indipendentemente da come si fa l’iterazione, quindi non dimenticatele una volta che avete imparato le tecniche FP che imparerete nella prossima sezione.</p>
<p>Ci sono quattro variazioni sul tema di base del ciclo for:</p>
<ol style="list-style-type: decimal">
<li>Modificare un oggetto esistente, invece di crearne uno nuovo.</li>
<li><ol style="list-style-type: decimal">
<li>Looping su nomi o valori, invece che su indici.</li>
</ol></li>
<li>Gestire uscite di lunghezza sconosciuta.</li>
<li>Gestione di sequenze di lunghezza sconosciuta.</li>
</ol>
<div id="modifica-di-un-oggetto-esistente" class="section level3" number="21.3.1">
<h3>
<span class="header-section-number">21.3.1</span> Modifica di un oggetto esistente<a class="anchor" aria-label="anchor" href="#modifica-di-un-oggetto-esistente"><i class="fas fa-link"></i></a>
</h3>
<p>A volte volete usare un ciclo for per modificare un oggetto esistente. Per esempio, ricordate la nostra sfida da <a href="funzioni.html#funzioni">funzioni</a>. Volevamo ridimensionare ogni colonna di un frame di dati:</p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rescale01</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">rng</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">rng</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">rescale01</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">rescale01</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu">rescale01</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">c</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">rescale01</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p>Per risolvere questo con un ciclo for pensiamo di nuovo ai tre componenti:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Output</strong>: abbiamo già l’output — è uguale all’input!</p></li>
<li><p><strong>Sequenza</strong>: possiamo pensare a un data frame come a una lista di colonne, quindi possiamo iterare su ogni colonna con <code>seq_along(df)</code>.</p></li>
<li><p><strong>Corpo</strong>: applicare <code>rescale01()</code>.</p></li>
</ol>
<p>Questo ci dà:</p>
<div class="sourceCode" id="cb546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">rescale01</span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Tipicamente modificherete una lista o un data frame con questo tipo di ciclo, quindi ricordatevi di usare <code>[[</code>, non <code>[</code>. Potreste aver notato che ho usato <code>[[</code> in tutti i miei cicli for: Penso sia meglio usare <code>[[</code> anche per i vettori atomici perché rende chiaro che voglio lavorare con un singolo elemento.</p>
</div>
<div id="modelli-di-looping" class="section level3" number="21.3.2">
<h3>
<span class="header-section-number">21.3.2</span> Modelli di looping<a class="anchor" aria-label="anchor" href="#modelli-di-looping"><i class="fas fa-link"></i></a>
</h3>
<p>Ci sono tre modi di base per fare un loop su un vettore. Finora vi ho mostrato il più generale: il looping sugli indici numerici con <code>for (i in seq_along(xs))</code>, e l’estrazione del valore con <code>x[[i]]</code>. Ci sono altre due forme:</p>
<ol style="list-style-type: decimal">
<li><p>Loop sugli elementi: <code>for (x in xs)</code>. Questo è più utile se vi interessa solo
preoccuparsi solo degli effetti collaterali, come tracciare o salvare un file, perché è
difficile salvare l’output in modo efficiente.</p></li>
<li>
<p>Fate un loop sui nomi: <code>for (nm in names(xs))</code>. Questo vi dà il nome, che
potete usare per accedere al valore con <code>x[[nm]]</code>. Questo è utile se volete
usare il nome nel titolo di un grafico o nel nome di un file. Se state creando
un output con nome, assicuratevi di nominare il vettore dei risultati in questo modo:</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
<p>L’iterazione sugli indici numerici è la forma più generale, perché data la posizione si può estrarre sia il nome che il valore:</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">value</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="lunghezza-di-uscita-sconosciuta" class="section level3" number="21.3.3">
<h3>
<span class="header-section-number">21.3.3</span> Lunghezza di uscita sconosciuta<a class="anchor" aria-label="anchor" href="#lunghezza-di-uscita-sconosciuta"><i class="fas fa-link"></i></a>
</h3>
<p>A volte potreste non sapere quanto sarà lungo l’output. Per esempio, immaginate di voler simulare alcuni vettori casuali di lunghezza casuale. Potreste essere tentati di risolvere questo problema facendo crescere progressivamente il vettore:</p>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">output</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">means</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:138] 0.912 0.205 2.584 -0.789 0.588 ...</span></span></code></pre></div>
<p>Ma questo non è molto efficiente perché in ogni iterazione, R deve copiare tutti i dati dalle iterazioni precedenti. In termini tecnici si ottiene un comportamento “quadratico” (<span class="math inline">\(O(n^2)\)</span>) che significa che un ciclo con un numero di elementi tre volte superiore richiederebbe nove (<span class="math inline">\(3^2\)</span>) volte più tempo per essere eseguito.</p>
<p>Una soluzione migliore è quella di salvare i risultati in una lista, e poi combinarli in un singolo vettore dopo che il ciclo è finito:</p>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">means</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : num [1:76] -0.3389 -0.0756 0.0402 0.1243 -0.9984 ...</span></span>
<span><span class="co">#&gt;  $ : num [1:17] -0.11 1.149 0.614 0.77 1.392 ...</span></span>
<span><span class="co">#&gt;  $ : num [1:41] 1.88 2.46 2.62 1.82 1.88 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:134] -0.3389 -0.0756 0.0402 0.1243 -0.9984 ...</span></span></code></pre></div>
<p>Qui ho usato <code><a href="https://rdrr.io/r/base/unlist.html">unlist()</a></code> per appiattire una lista di vettori in un singolo vettore. Un’opzione più rigorosa è quella di usare <code>purrr::flatten_dbl()</code> — esso darà un errore se l’input non è una lista di double.</p>
<p>Questo schema si verifica anche in altri posti:</p>
<ol style="list-style-type: decimal">
<li><p>Potreste generare una lunga stringa. Invece di <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> insieme
ogni iterazione con la precedente, salvate l’output in un vettore di caratteri e
poi combinate quel vettore in una singola stringa con
<code>paste(output, collapse = "")</code>.</p></li>
<li><p>Potreste generare un grande frame di dati. Invece di sequenziare
<code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>in ogni iterazione, salvate l’output in una lista, poi usate
<code>dplyr::bind_rows(output)</code> per combinare l’output in un singolo
frame di dati.</p></li>
</ol>
<p>Fate attenzione a questo schema. Ogni volta che lo vedete, passate ad un oggetto risultato più complesso, e poi combinate in un solo passo alla fine.</p>
</div>
<div id="lunghezza-della-sequenza-sconosciuta" class="section level3" number="21.3.4">
<h3>
<span class="header-section-number">21.3.4</span> Lunghezza della sequenza sconosciuta<a class="anchor" aria-label="anchor" href="#lunghezza-della-sequenza-sconosciuta"><i class="fas fa-link"></i></a>
</h3>
<p>A volte non sapete nemmeno per quanto tempo la sequenza di input debba essere eseguita. Questo è comune quando si fanno simulazioni. Per esempio, potreste voler fare un ciclo finché non ottenete tre teste in fila. Non potete fare questo tipo di iterazione con il ciclo for. Invece, potete usare un ciclo while. Un ciclo while è più semplice del ciclo for perché ha solo due componenti, una condizione e un corpo:</p>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">while</span> <span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># corpo</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Un ciclo while è anche più generale di un ciclo for, perché potete riscrivere qualsiasi ciclo for come un ciclo while, ma non potete riscrivere ogni ciclo while come un ciclo for:</p>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># corpo</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Equivalente a</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="va">i</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># corpo</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Ecco come potremmo usare un ciclo while per trovare quanti tentativi ci vogliono per ottenere tre teste di fila:</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flip</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flips</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">nheads</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="va">nheads</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">flip</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">nheads</span> <span class="op">&lt;-</span> <span class="va">nheads</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">nheads</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">flips</span> <span class="op">&lt;-</span> <span class="va">flips</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span><span class="va">flips</span></span>
<span><span class="co">#&gt; [1] 21</span></span></code></pre></div>
<p>Menziono i cicli while solo brevemente, perché non li uso quasi mai. Sono più spesso usati per la simulazione, che è al di fuori dello scopo di questo libro. Tuttavia, è bene sapere che esistono in modo da essere preparati per problemi in cui il numero di iterazioni non è noto in anticipo.</p>
</div>
<div id="esercizi-59" class="section level3" number="21.3.5">
<h3>
<span class="header-section-number">21.3.5</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-59"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Immaginate di avere una directory piena di file CSV che volete leggere.
Avete i loro percorsi in un vettore,
<code>files &lt;- dir("data/", pattern = "\\csv$", full.names = TRUE)</code>, e ora
vuole leggere ognuno di essi con <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code>. Scrivete il ciclo for che
li carichi in un singolo frame di dati.</p></li>
<li><p>Cosa succede se usate <code>for (nm in names(x))</code> e <code>x</code> non ha nomi?
Cosa succede se solo alcuni degli elementi hanno un nome? Cosa succede se i nomi non sono
non sono unici?</p></li>
<li>
<p>Scrivete una funzione che stampi la media di ogni colonna numerica in un data
dati, insieme al suo nome. Per esempio, <code>show_mean(iris)</code> stamperebbe:</p>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show_mean</span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sepal.Length: 5.84</span></span>
<span><span class="co">#&gt; Sepal.Width:  3.06</span></span>
<span><span class="co">#&gt; Petal.Length: 3.76</span></span>
<span><span class="co">#&gt; Petal.Width:  1.20</span></span></code></pre></div>
<p>(Sfida extra: quale funzione ho usato per assicurarmi che i numeri fossero ben allineati, anche se i nomi delle variabili avevano lunghezze diverse?)</p>
</li>
<li>
<p>Cosa fa questo codice? Come funziona?</p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> </span>
<span>  disp <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">0.0163871</span>,</span>
<span>  am <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">x</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"manual"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trans</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mtcars</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">trans</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="va">mtcars</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
</ol>
</div>
</div>
<div id="cicli-for-vs.-funzionali" class="section level2" number="21.4">
<h2>
<span class="header-section-number">21.4</span> Cicli for vs. funzionali<a class="anchor" aria-label="anchor" href="#cicli-for-vs.-funzionali"><i class="fas fa-link"></i></a>
</h2>
<p>I cicli for non sono così importanti in R come lo sono in altri linguaggi perché R è un linguaggio di programmazione funzionale. Questo significa che è possibile avvolgere i cicli for in una funzione e chiamare quella funzione invece di usare direttamente il ciclo for.</p>
<p>Per vedere perché questo è importante, considerate (di nuovo) questo semplice frame di dati:</p>
<div class="sourceCode" id="cb556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Immaginate di voler calcolare la media di ogni colonna. Potreste farlo con un ciclo for:</p>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output</span></span>
<span><span class="co">#&gt; [1] -0.3260369  0.1356639  0.4291403 -0.2498034</span></span></code></pre></div>
<p>Vi rendete conto che vorrete calcolare la media di ogni colonna abbastanza frequentemente, quindi la estraete in una funzione:</p>
<div class="sourceCode" id="cb558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">output</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">output</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Ma poi pensate che sarebbe utile poter calcolare anche la mediana e la deviazione standard, quindi copiate e incollate la vostra funzione <code>col_mean()</code> e sostituite la <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> con <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code> e <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>:</p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_median</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">output</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">output</span></span>
<span><span class="op">}</span></span>
<span><span class="va">col_sd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">output</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">output</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Uh oh! Avete copiato e incollato questo codice due volte, quindi è il momento di pensare a come generalizzarlo. Notate che la maggior parte di questo codice è un boilerplate for-loop ed è difficile vedere l’unica cosa (<code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>) che è diversa tra le funzioni.</p>
<p>Cosa fareste se vedeste una serie di funzioni come questa:</p>
<div class="sourceCode" id="cb560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">1</span></span>
<span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span></span>
<span><span class="va">f3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">3</span></span></code></pre></div>
<p>Si spera di notare che ci sono molti doppioni e di estrarli in un argomento aggiuntivo:</p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="va">i</span></span></code></pre></div>
<p>Avete ridotto la possibilità di generare bug (perché ora avete 1/3 del codice originale), e lo avete reso facile da generalizzare a nuove situazioni.</p>
<p>Possiamo fare esattamente la stessa cosa con <code>col_mean()</code>, <code>col_median()</code> e <code>col_sd()</code> aggiungendo un argomento che fornisce la funzione da applicare ad ogni colonna:</p>
<div class="sourceCode" id="cb562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">fun</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">fun</span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">col_summary</span><span class="op">(</span><span class="va">df</span>, <span class="va">median</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.51850298  0.02779864  0.17295591 -0.61163819</span></span>
<span><span class="fu">col_summary</span><span class="op">(</span><span class="va">df</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.3260369  0.1356639  0.4291403 -0.2498034</span></span></code></pre></div>
<p>L’idea di passare una funzione ad un’altra funzione è un’idea estremamente potente, ed è uno dei comportamenti che rende R un linguaggio di programmazione funzionale. Potrebbe volerci un po’ di tempo per comprendere l’idea, ma ne vale la pena. Nel resto del capitolo, conoscerete e userete il pacchetto <strong>purrr</strong>, che fornisce funzioni che eliminano la necessità di molti comuni cicli for. La famiglia di funzioni apply in R base (<code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>, <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code>, etc) risolve un problema simile, ma purrr è più coerente e quindi più facile da imparare.</p>
<p>L’obiettivo di usare le funzioni purrr al posto dei cicli for è di permettervi di rompere le comuni sfide di manipolazione delle liste in pezzi indipendenti:</p>
<ol style="list-style-type: decimal">
<li><p>Come puoi risolvere il problema per un singolo elemento della lista? Una volta
una volta risolto il problema, purrr si occupa di generalizzare la
soluzione ad ogni elemento della lista.</p></li>
<li><p>Se stai risolvendo un problema complesso, come puoi scomporlo in
pezzi che ti permettono di avanzare di un piccolo passo verso la soluzione?
soluzione? Con Purrr, ottieni tanti piccoli pezzi che puoi
comporre insieme con il tubo.</p></li>
</ol>
<p>Questa struttura rende più facile risolvere nuovi problemi. Rende anche più facile capire le tue soluzioni ai vecchi problemi quando rileggi il tuo vecchio codice.</p>
<div id="esercizi-60" class="section level3" number="21.4.1">
<h3>
<span class="header-section-number">21.4.1</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-60"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Leggete la documentazione per <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>. Nel caso 2d, quali due cicli for
generalizza?</p></li>
<li><p>Adattate <code>col_summary()</code> in modo che si applichi solo alle colonne numeriche
Potreste voler iniziare con una funzione <code><a href="https://purrr.tidyverse.org/reference/is_numeric.html">is_numeric()</a></code> che restituisca
un vettore logico che ha un TRUE corrispondente ad ogni colonna numerica.</p></li>
</ol>
</div>
</div>
<div id="le-funzioni-map" class="section level2" number="21.5">
<h2>
<span class="header-section-number">21.5</span> Le funzioni map<a class="anchor" aria-label="anchor" href="#le-funzioni-map"><i class="fas fa-link"></i></a>
</h2>
<p>Lo schema di eseguire un ciclo su un vettore, fare qualcosa ad ogni elemento e salvare i risultati è così comune che il pacchetto purrr fornisce una famiglia di funzioni che lo fanno per voi. C’è una funzione per ogni tipo di output:</p>
<ul>
<li>
<code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> fa una lista.</li>
<li>
<code><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl()</a></code> crea un vettore logico.</li>
<li>
<code><a href="https://purrr.tidyverse.org/reference/map.html">map_int()</a></code> crea un vettore intero.</li>
<li>
<code><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl()</a></code> crea un vettore doppio.</li>
<li>La funzione <code><a href="https://purrr.tidyverse.org/reference/map.html">map_chr()</a></code> crea un vettore di caratteri.</li>
</ul>
<p>Ogni funzione prende un vettore come input, applica una funzione ad ogni pezzo, e poi restituisce un nuovo vettore che ha la stessa lunghezza (e gli stessi nomi) dell’input. Il tipo di vettore è determinato dal suffisso della funzione map.</p>
<p>Una volta che padroneggiate queste funzioni, scoprirete che ci vuole molto meno tempo per risolvere i problemi di iterazione. Ma non dovreste mai sentirvi in colpa se usate un ciclo for invece di una funzione map. Le funzioni mappa sono un passo avanti nella torre di astrazione, e può volerci molto tempo per capire come funzionano. L’importante è che risolviate il problema su cui state lavorando, non che scriviate il codice più conciso ed elegante (anche se è sicuramente qualcosa a cui volete tendere!).</p>
<p>Alcune persone vi diranno di evitare i cicli for perché sono lenti. Si sbagliano! (Beh, almeno sono piuttosto fuori moda, dato che i cicli for non sono stati lenti per molti anni). Il principale vantaggio di usare funzioni come <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> non è la velocità, ma la chiarezza: rendono il vostro codice più facile da scrivere e da leggere.</p>
<p>Possiamo usare queste funzioni per eseguire gli stessi calcoli dell’ultimo ciclo for. Quelle funzioni di riepilogo hanno restituito dei doppi, quindi abbiamo bisogno di usare <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl()</a></code>:</p>
<div class="sourceCode" id="cb563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt;          a          b          c          d </span></span>
<span><span class="co">#&gt; -0.3260369  0.1356639  0.4291403 -0.2498034</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">median</span><span class="op">)</span></span>
<span><span class="co">#&gt;           a           b           c           d </span></span>
<span><span class="co">#&gt; -0.51850298  0.02779864  0.17295591 -0.61163819</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">sd</span><span class="op">)</span></span>
<span><span class="co">#&gt;         a         b         c         d </span></span>
<span><span class="co">#&gt; 0.9214834 0.4848945 0.9816016 1.1563324</span></span></code></pre></div>
<p>Rispetto all’uso di un ciclo for, l’attenzione si concentra sull’operazione che viene eseguita (cioè <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>), non sulla contabilità richiesta per fare il loop su ogni elemento e memorizzare l’output. Questo è ancora più evidente se usiamo la pipe:</p>
<div class="sourceCode" id="cb564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt;          a          b          c          d </span></span>
<span><span class="co">#&gt; -0.3260369  0.1356639  0.4291403 -0.2498034</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="co">#&gt;           a           b           c           d </span></span>
<span><span class="co">#&gt; -0.51850298  0.02779864  0.17295591 -0.61163819</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">sd</span><span class="op">)</span></span>
<span><span class="co">#&gt;         a         b         c         d </span></span>
<span><span class="co">#&gt; 0.9214834 0.4848945 0.9816016 1.1563324</span></span></code></pre></div>
<p>Ci sono alcune differenze tra <code>map_*()</code> e <code>col_summary()</code>:</p>
<ul>
<li><p>Tutte le funzioni purrr sono implementate in C. Questo le rende un po’ più veloci
a spese della leggibilità.</p></li>
<li><p>Il secondo argomento, <code>.f</code>, la funzione da applicare, può essere una formula, un
vettore di caratteri o un vettore di interi. Imparerete queste comode
scorciatoie nella prossima sezione.</p></li>
<li>
<p><code>map_*()</code> usa … ([dot dot dot]) per passare ulteriori argomenti
a <code>.f</code> ogni volta che viene chiamato:</p>
<div class="sourceCode" id="cb565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">mean</span>, trim <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt;           a           b           c           d </span></span>
<span><span class="co">#&gt; -0.51850298  0.02779864  0.17295591 -0.61163819</span></span></code></pre></div>
</li>
<li>
<p>Le funzioni map conservano anche i nomi:</p>
<div class="sourceCode" id="cb566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, y <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">length</span><span class="op">)</span></span>
<span><span class="co">#&gt; x y </span></span>
<span><span class="co">#&gt; 3 2</span></span></code></pre></div>
</li>
</ul>
<div id="scorciatoie" class="section level3" number="21.5.1">
<h3>
<span class="header-section-number">21.5.1</span> Scorciatoie<a class="anchor" aria-label="anchor" href="#scorciatoie"><i class="fas fa-link"></i></a>
</h3>
<p>Ci sono alcune scorciatoie che potete usare con <code>.f</code> per risparmiare un po’ di battitura. Immaginate di voler adattare un modello lineare ad ogni gruppo in un set di dati. Il seguente esempio giocattolo divide il dataset <code>mtcars</code> in tre pezzi (uno per ogni valore di cilindro) e adatta lo stesso modello lineare ad ogni pezzo:</p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>La sintassi per creare una funzione anonima in R è piuttosto prolissa, così purrr fornisce una comoda scorciatoia: una formula unilaterale.</p>
<div class="sourceCode" id="cb568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Qui ho usato <code>.</code> come pronome: si riferisce all’elemento corrente della lista (nello stesso modo in cui <code>i</code> si riferisce all’indice corrente nel ciclo for).</p>
<p>Quando state guardando molti modelli, potreste voler estrarre una statistica riassuntiva come il <span class="math inline">\(R^2\)</span>. Per farlo dobbiamo prima eseguire <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> e poi estrarre il componente chiamato <code>r.quadrato</code>. Potremmo farlo usando la scorciatoia per le funzioni anonime:</p>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="op">~</span><span class="va">.</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span></span>
<span><span class="co">#&gt;         4         6         8 </span></span>
<span><span class="co">#&gt; 0.5086326 0.4645102 0.4229655</span></span></code></pre></div>
<p>Ma estrarre componenti con nome è un’operazione comune, quindi purrr fornisce una scorciatoia ancora più breve: si può usare una stringa.</p>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="st">"r.squared"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         4         6         8 </span></span>
<span><span class="co">#&gt; 0.5086326 0.4645102 0.4229655</span></span></code></pre></div>
<p>Potete anche usare un intero per selezionare gli elementi in base alla posizione:</p>
<div class="sourceCode" id="cb571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2 5 8</span></span></code></pre></div>
</div>
<div id="base-r" class="section level3" number="21.5.2">
<h3>
<span class="header-section-number">21.5.2</span> Base R<a class="anchor" aria-label="anchor" href="#base-r"><i class="fas fa-link"></i></a>
</h3>
<p>Se avete familiarità con la famiglia di funzioni apply in R base, potreste aver notato alcune somiglianze con le funzioni purrr:</p>
<ul>
<li><p><code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> è fondamentalmente identica a <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>, eccetto che <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> è
coerente con tutte le altre funzioni in purrr, e potete usare le
scorciatoie per <code>.f</code>.</p></li>
<li>
<p>Base <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> è un wrapper intorno a <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> che automaticamente
semplifica l’output. Questo è utile per il lavoro interattivo ma è
problematico in una funzione perché non si sa mai che tipo di output
otterrete:</p>
<div class="sourceCode" id="cb572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.27</span>, <span class="fl">0.37</span>, <span class="fl">0.57</span>, <span class="fl">0.91</span>, <span class="fl">0.20</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.90</span>, <span class="fl">0.94</span>, <span class="fl">0.66</span>, <span class="fl">0.63</span>, <span class="fl">0.06</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.21</span>, <span class="fl">0.18</span>, <span class="fl">0.69</span>, <span class="fl">0.38</span>, <span class="fl">0.77</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.72</span>, <span class="fl">0.99</span>, <span class="fl">0.38</span>, <span class="fl">0.78</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.93</span>, <span class="fl">0.21</span>, <span class="fl">0.65</span>, <span class="fl">0.13</span>, <span class="fl">0.27</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.39</span>, <span class="fl">0.01</span>, <span class="fl">0.38</span>, <span class="fl">0.87</span>, <span class="fl">0.34</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">cutoff</span> <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="va">cutoff</span><span class="op">]</span></span>
<span><span class="va">x1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : num 0.91</span></span>
<span><span class="co">#&gt;  $ : num [1:2] 0.9 0.94</span></span>
<span><span class="co">#&gt;  $ : num(0)</span></span>
<span><span class="va">x2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:3] 0.99 0.93 0.87</span></span></code></pre></div>
</li>
<li><p><code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code> è un’alternativa sicura a <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> perché si fornisce un
argomento aggiuntivo che definisce il tipo. L’unico problema con
<code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code> è che richiede un sacco di battitura:
<code>vapply(df, is.numeric, logical(1))</code> è equivalente a
<code>map_lgl(df, is.numeric)</code>. Un vantaggio di <code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code> rispetto alle funzioni map
è che può produrre anche matrici — le funzioni map producono solo
producono solo vettori.</p></li>
</ul>
<p>Mi concentro qui sulle funzioni di Purrr perché hanno nomi e argomenti più coerenti, utili scorciatoie, e in futuro forniranno un facile parallelismo e barre di progresso.</p>
</div>
<div id="esercizi-61" class="section level3" number="21.5.3">
<h3>
<span class="header-section-number">21.5.3</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-61"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Scrivete del codice che usi una delle funzioni map per:</p>
<ol style="list-style-type: decimal">
<li><ol style="list-style-type: decimal">
<li>Calcolare la media di ogni colonna in <code>mtcars</code>.</li>
</ol></li>
<li>Determinare il tipo di ogni colonna in <code><a href="https://rdrr.io/pkg/nycflights13/man/flights.html">nycflights13::flights</a></code>.</li>
<li>Calcolare il numero di valori unici in ogni colonna di <code>iris</code>.</li>
<li>Genera 10 normali casuali da distribuzioni con medie di -10, 0, 10 e 100.</li>
</ol>
</li>
<li><p>Come si può creare un singolo vettore che per ogni colonna di un data frame
indichi se è un fattore o meno?</p></li>
<li><p>Cosa succede quando usi le funzioni map su vettori che non sono liste?
Cosa fa la funzione <code>map(1:5, runif)</code>? Perché?</p></li>
<li>
<p>Cosa fa <code>map(-2:2, rnorm, n = 5)</code>? Perché?</p>
<ol start="2" style="list-style-type: decimal">
<li>Che cosa fa <code>map_dbl(-2:2, rnorm, n = 5)</code>? Perché?</li>
</ol>
</li>
<li><p>Riscrivete <code>map(x, function(df) lm(mpg ~ wt, data = df))</code> per eliminare la
funzione anonima.</p></li>
</ol>
</div>
</div>
<div id="affrontare-il-fallimento" class="section level2" number="21.6">
<h2>
<span class="header-section-number">21.6</span> Affrontare il fallimento<a class="anchor" aria-label="anchor" href="#affrontare-il-fallimento"><i class="fas fa-link"></i></a>
</h2>
<p>Quando usate le funzioni map per ripetere molte operazioni, le possibilità che una di queste operazioni fallisca sono molto più alte. Quando ciò accade, si ottiene un messaggio di errore e nessun output. Questo è fastidioso: perché un fallimento vi impedisce di accedere a tutti gli altri successi? Come ci si assicura che una mela marcia non rovini l’intero barile?</p>
<p>In questa sezione imparerete come affrontare questa situazione con una nuova funzione: <code><a href="https://purrr.tidyverse.org/reference/safely.html">safely()</a></code>. La funzione <code><a href="https://purrr.tidyverse.org/reference/safely.html">safely()</a></code> è un avverbio: prende una funzione (un verbo) e ne restituisce una versione modificata. In questo caso, la funzione modificata non darà mai un errore. Invece, restituisce sempre una lista con due elementi:</p>
<ol style="list-style-type: decimal">
<li><p><code>result</code> è il risultato originale. Se c’è stato un errore, questo sarà <code>NULL</code>.</p></li>
<li><p><code>error</code> è un oggetto di errore. Se l’operazione ha avuto successo, questo sarà
<code>NULL</code>.</p></li>
</ol>
<p>(Potreste avere familiarità con la funzione <code><a href="https://rdrr.io/r/base/try.html">try()</a></code> in R base. È simile, ma poiché a volte restituisce il risultato originale e a volte restituisce un oggetto errore, è più difficile lavorarci).</p>
<p>Illustriamo questo con un semplice esempio: <code><a href="https://rdrr.io/r/base/Log.html">log()</a></code>:</p>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">safe_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html">safely</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="fu">safe_log</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ result: num 2.3</span></span>
<span><span class="co">#&gt;  $ error : NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="fu">safe_log</span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ result: NULL</span></span>
<span><span class="co">#&gt;  $ error :List of 2</span></span>
<span><span class="co">#&gt;   ..$ message: chr "non-numeric argument to mathematical function"</span></span>
<span><span class="co">#&gt;   ..$ call   : language .Primitive("log")(x, base)</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "simpleError" "error" "condition"</span></span></code></pre></div>
<p>Quando la funzione ha successo, l’elemento <code>result</code> contiene il risultato e l’elemento <code>error</code> è <code>NULL</code>. Quando la funzione fallisce, l’elemento <code>result</code> è <code>NULL</code> e l’elemento <code>error</code> contiene un oggetto di errore.</p>
<p>La funzione <code><a href="https://purrr.tidyverse.org/reference/safely.html">safely()</a></code> è progettata per lavorare con map:</p>
<div class="sourceCode" id="cb574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html">safely</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ result: num 0</span></span>
<span><span class="co">#&gt;   ..$ error : NULL</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ result: num 2.3</span></span>
<span><span class="co">#&gt;   ..$ error : NULL</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ result: NULL</span></span>
<span><span class="co">#&gt;   ..$ error :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ message: chr "non-numeric argument to mathematical function"</span></span>
<span><span class="co">#&gt;   .. ..$ call   : language .Primitive("log")(x, base)</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "class")= chr [1:3] "simpleError" "error" "condition"</span></span></code></pre></div>
<p>Sarebbe più facile lavorare con questo se avessimo due liste: una di tutti gli errori e una di tutti gli output. Questo è facile da ottenere con <code><a href="https://purrr.tidyverse.org/reference/transpose.html">purrr::transpose()</a></code>:</p>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/transpose.html">transpose</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ result:List of 3</span></span>
<span><span class="co">#&gt;   ..$ : num 0</span></span>
<span><span class="co">#&gt;   ..$ : num 2.3</span></span>
<span><span class="co">#&gt;   ..$ : NULL</span></span>
<span><span class="co">#&gt;  $ error :List of 3</span></span>
<span><span class="co">#&gt;   ..$ : NULL</span></span>
<span><span class="co">#&gt;   ..$ : NULL</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ message: chr "non-numeric argument to mathematical function"</span></span>
<span><span class="co">#&gt;   .. ..$ call   : language .Primitive("log")(x, base)</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "class")= chr [1:3] "simpleError" "error" "condition"</span></span></code></pre></div>
<p>Sta a te decidere come trattare gli errori, ma tipicamente guarderai i valori di <code>x</code> dove <code>y</code> è un errore, o lavorerai con i valori di <code>y</code> che sono ok:</p>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_ok</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">$</span><span class="va">error</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">is_null</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="va">is_ok</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "a"</span></span>
<span><span class="va">y</span><span class="op">$</span><span class="va">result</span><span class="op">[</span><span class="va">is_ok</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">flatten_dbl</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000000 2.302585</span></span></code></pre></div>
<p>Purrr fornisce altri due utili avverbi:</p>
<ul>
<li>
<p>Come <code><a href="https://purrr.tidyverse.org/reference/safely.html">safely()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/safely.html">possibly()</a></code> ha sempre successo. È più semplice di <code><a href="https://purrr.tidyverse.org/reference/safely.html">safely()</a></code>, perché gli si dà un valore predefinito da restituire in caso di errore.</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html">possibly</a></span><span class="op">(</span><span class="va">log</span>, <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000000 2.302585       NA</span></span></code></pre></div>
</li>
<li>
<p><code><a href="https://purrr.tidyverse.org/reference/safely.html">quietly()</a></code> svolge un ruolo simile a quello di <code><a href="https://purrr.tidyverse.org/reference/safely.html">safely()</a></code>, ma invece di catturare gli errori, cattura l’output stampato, i messaggi e gli avvertimenti:</p>
<div class="sourceCode" id="cb578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html">quietly</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ :List of 4</span></span>
<span><span class="co">#&gt;   ..$ result  : num 0</span></span>
<span><span class="co">#&gt;   ..$ output  : chr ""</span></span>
<span><span class="co">#&gt;   ..$ warnings: chr(0) </span></span>
<span><span class="co">#&gt;   ..$ messages: chr(0) </span></span>
<span><span class="co">#&gt;  $ :List of 4</span></span>
<span><span class="co">#&gt;   ..$ result  : num NaN</span></span>
<span><span class="co">#&gt;   ..$ output  : chr ""</span></span>
<span><span class="co">#&gt;   ..$ warnings: chr "NaNs produced"</span></span>
<span><span class="co">#&gt;   ..$ messages: chr(0)</span></span></code></pre></div>
</li>
</ul>
</div>
<div id="map-su-più-argomenti" class="section level2" number="21.7">
<h2>
<span class="header-section-number">21.7</span> Map su più argomenti<a class="anchor" aria-label="anchor" href="#map-su-pi%C3%B9-argomenti"><i class="fas fa-link"></i></a>
</h2>
<p>Finora abbiamo mappato lungo un singolo input. Ma spesso avete più input correlati che avete bisogno di iterare in parallelo. Questo è il lavoro delle funzioni <code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code> e <code><a href="https://purrr.tidyverse.org/reference/map2.html">pmap()</a></code>. Per esempio, immaginate di voler simulare alcune normali casuali con mezzi diversi. Sapete come farlo con <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>:</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">mu</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">rnorm</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : num [1:5] 5.63 7.1 4.39 3.37 4.99</span></span>
<span><span class="co">#&gt;  $ : num [1:5] 9.34 9.33 9.52 11.32 10.64</span></span>
<span><span class="co">#&gt;  $ : num [1:5] -2.49 -4.75 -2.11 -2.78 -2.42</span></span></code></pre></div>
<p>E se si volesse variare anche la deviazione standard? Un modo per farlo sarebbe quello di iterare sugli indici e indicizzare in vettori di medie e deviazioni standard:</p>
<div class="sourceCode" id="cb580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">mu</span><span class="op">[[</span><span class="va">.</span><span class="op">]</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[[</span><span class="va">.</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : num [1:5] 4.82 5.74 4 2.06 5.72</span></span>
<span><span class="co">#&gt;  $ : num [1:5] 6.51 0.529 10.381 14.377 12.269</span></span>
<span><span class="co">#&gt;  $ : num [1:5] -11.51 2.66 8.52 -10.56 -7.89</span></span></code></pre></div>
<p>Ma questo offusca l’intento del codice. Invece potremmo usare <code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code> che itera su due vettori in parallelo:</p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span>, <span class="va">rnorm</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : num [1:5] 3.83 4.52 5.12 3.23 3.59</span></span>
<span><span class="co">#&gt;  $ : num [1:5] 13.55 3.8 8.16 12.31 8.39</span></span>
<span><span class="co">#&gt;  $ : num [1:5] -15.872 -13.3 12.141 0.469 14.794</span></span></code></pre></div>
<p><code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code> genera questa serie di chiamate di funzioni:</p>
<div class="inline-figure"><img src="diagrams/lists-map2.png" width="70%" style="display: block; margin: auto;"></div>
<p>Notate che gli argomenti che variano per ogni chiamata vengono <em>prima</em> della funzione; gli argomenti che sono gli stessi per ogni chiamata vengono <em>dopo</em>.</p>
<p>Come <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code> è solo un involucro attorno ad un ciclo for:</p>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">f</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Si potrebbe anche immaginare <code>map3()</code>, <code>map4()</code>, <code>map5()</code>, <code>map6()</code> ecc. Invece, purrr fornisce <code><a href="https://purrr.tidyverse.org/reference/map2.html">pmap()</a></code> che prende una lista di argomenti. Potreste usarlo se voleste variare la media, la deviazione standard e il numero di campioni:</p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">args1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span></span>
<span><span class="va">args1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap</a></span><span class="op">(</span><span class="va">rnorm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : num 5.39</span></span>
<span><span class="co">#&gt;  $ : num [1:3] 5.41 2.08 9.58</span></span>
<span><span class="co">#&gt;  $ : num [1:5] -23.85 -2.96 -6.56 8.46 -5.21</span></span></code></pre></div>
<p>Questo sembra:</p>
<div class="inline-figure"><img src="diagrams/lists-pmap-unnamed.png" width="70%" style="display: block; margin: auto;"></div>
<p>Se non nominate gli elementi della lista, <code><a href="https://purrr.tidyverse.org/reference/map2.html">pmap()</a></code> userà la corrispondenza posizionale quando chiama la funzione. Questo è un po’ fragile e rende il codice più difficile da leggere, quindi è meglio nominare gli argomenti:</p>
<div class="sourceCode" id="cb584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">args2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="va">sigma</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">args2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap</a></span><span class="op">(</span><span class="va">rnorm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Questo genera chiamate più lunghe, ma più sicure:</p>
<div class="inline-figure"><img src="diagrams/lists-pmap-named.png" width="70%" style="display: block; margin: auto;"></div>
<p>Poiché gli argomenti sono tutti della stessa lunghezza, ha senso memorizzarli in un frame di dati:</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">mean</span>, <span class="op">~</span><span class="va">sd</span>, <span class="op">~</span><span class="va">n</span>,</span>
<span>    <span class="fl">5</span>,     <span class="fl">1</span>,  <span class="fl">1</span>,</span>
<span>   <span class="fl">10</span>,     <span class="fl">5</span>,  <span class="fl">3</span>,</span>
<span>   <span class="op">-</span><span class="fl">3</span>,    <span class="fl">10</span>,  <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap</a></span><span class="op">(</span><span class="va">rnorm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 6.018179</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1]  8.681404 18.292712  6.129566</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] -12.239379  -5.755334  -8.933997  -4.222859   8.797842</span></span></code></pre></div>
<p>Non appena il vostro codice diventa complicato, penso che un data frame sia un buon approccio perché assicura che ogni colonna abbia un nome e sia della stessa lunghezza di tutte le altre colonne.</p>
<div id="invocare-diverse-funzioni" class="section level3" number="21.7.1">
<h3>
<span class="header-section-number">21.7.1</span> Invocare diverse funzioni<a class="anchor" aria-label="anchor" href="#invocare-diverse-funzioni"><i class="fas fa-link"></i></a>
</h3>
<p>C’è un ulteriore passo avanti nella complessità: oltre a variare gli argomenti della funzione, potreste anche variare la funzione stessa:</p>
<div class="sourceCode" id="cb586"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"runif"</span>, <span class="st">"rnorm"</span>, <span class="st">"rpois"</span><span class="op">)</span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Per gestire questo caso, potete usare <code><a href="https://purrr.tidyverse.org/reference/invoke.html">invoke_map()</a></code>:</p>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/invoke.html">invoke_map</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">param</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : num [1:5] 0.479 0.439 -0.471 0.348 -0.581</span></span>
<span><span class="co">#&gt;  $ : num [1:5] 2.48 3.9 7.54 -9.12 3.94</span></span>
<span><span class="co">#&gt;  $ : int [1:5] 6 11 5 8 9</span></span></code></pre></div>
<div class="inline-figure"><img src="diagrams/lists-invoke.png" width="1110" style="display: block; margin: auto;"></div>
<p>Il primo argomento è una lista di funzioni o un vettore di caratteri di nomi di funzioni. Il secondo argomento è una lista di liste che danno gli argomenti che variano per ogni funzione. Gli argomenti successivi sono passati ad ogni funzione.</p>
<p>E ancora, potete usare <code><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble()</a></code> per rendere la creazione di queste coppie di argomenti un po’ più facile:</p>
<div class="sourceCode" id="cb588"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">f</span>,      <span class="op">~</span><span class="va">params</span>,</span>
<span>  <span class="st">"runif"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"rnorm"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"rpois"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/invoke.html">invoke_map</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">params</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="walk" class="section level2" number="21.8">
<h2>
<span class="header-section-number">21.8</span> Walk<a class="anchor" aria-label="anchor" href="#walk"><i class="fas fa-link"></i></a>
</h2>
<p>Walk è un’alternativa a map che si usa quando si vuole chiamare una funzione per i suoi effetti collaterali, piuttosto che per il suo valore di ritorno. Di solito lo fai perché vuoi rendere l’output sullo schermo o salvare file su disco - la cosa importante è l’azione, non il valore di ritorno. Ecco un esempio molto semplice:</p>
<div class="sourceCode" id="cb589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"a"</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">walk</a></span><span class="op">(</span><span class="va">print</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; [1] "a"</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p><code><a href="https://purrr.tidyverse.org/reference/map.html">walk()</a></code> non è generalmente molto utile rispetto a <code><a href="https://purrr.tidyverse.org/reference/map2.html">walk2()</a></code> o <code><a href="https://purrr.tidyverse.org/reference/map2.html">pwalk()</a></code>. Per esempio, se avete una lista di trame e un vettore di nomi di file, potreste usare <code><a href="https://purrr.tidyverse.org/reference/map2.html">pwalk()</a></code> per salvare ogni file nella posizione corrispondente sul disco:</p>
<div class="sourceCode" id="cb590"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">wt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span>, <span class="st">".pdf"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pwalk</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">paths</span>, <span class="va">plots</span><span class="op">)</span>, <span class="va">ggsave</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://purrr.tidyverse.org/reference/map.html">walk()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/map2.html">walk2()</a></code> e <code><a href="https://purrr.tidyverse.org/reference/map2.html">pwalk()</a></code> restituiscono tutti invisibilmente <code>.x</code>, il primo argomento. Questo li rende adatti all’uso nel mezzo delle pipeline.</p>
</div>
<div id="altri-modelli-di-cicli-for" class="section level2" number="21.9">
<h2>
<span class="header-section-number">21.9</span> Altri modelli di cicli for<a class="anchor" aria-label="anchor" href="#altri-modelli-di-cicli-for"><i class="fas fa-link"></i></a>
</h2>
<p>Purrr fornisce un certo numero di altre funzioni che astraggono da altri tipi di cicli for. Le userai meno frequentemente delle funzioni di mappa, ma sono utili da conoscere. L’obiettivo qui è di illustrare brevemente ogni funzione, così speriamo che vi venga in mente se vedete un problema simile in futuro. Poi si può andare a cercare la documentazione per maggiori dettagli.</p>
<div id="funzioni-predicate" class="section level3" number="21.9.1">
<h3>
<span class="header-section-number">21.9.1</span> Funzioni predicate<a class="anchor" aria-label="anchor" href="#funzioni-predicate"><i class="fas fa-link"></i></a>
</h3>
<p>Un certo numero di funzioni lavorano con funzioni <strong>predicate</strong> che restituiscono un singolo <code>TRUE</code> o <code>FALSE</code>.</p>
<p>Le funzioni <code><a href="https://purrr.tidyverse.org/reference/keep.html">keep()</a></code> e <code><a href="https://purrr.tidyverse.org/reference/keep.html">discard()</a></code> mantengono gli elementi dell’input dove il predicato è rispettivamente <code>TRUE</code> o <code>FALSE</code>:</p>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">keep</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    150 obs. of  1 variable:</span></span>
<span><span class="co">#&gt;  $ Species: Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span></span>
<span><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">discard</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    150 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...</span></span>
<span><span class="co">#&gt;  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...</span></span>
<span><span class="co">#&gt;  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...</span></span>
<span><span class="co">#&gt;  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...</span></span></code></pre></div>
<p><code><a href="https://purrr.tidyverse.org/reference/every.html">some()</a></code> e <code><a href="https://purrr.tidyverse.org/reference/every.html">every()</a></code> determinano se il predicato è vero per qualsiasi o per tutti gli elementi.</p>
<div class="sourceCode" id="cb592"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">letters</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/every.html">some</a></span><span class="op">(</span><span class="va">is_character</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/every.html">every</a></span><span class="op">(</span><span class="va">is_vector</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p><code><a href="https://purrr.tidyverse.org/reference/detect.html">detect()</a></code> trova il primo elemento in cui il predicato è vero; <code><a href="https://purrr.tidyverse.org/reference/detect.html">detect_index()</a></code> restituisce la sua posizione.</p>
<div class="sourceCode" id="cb593"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt;  [1] 10  6  1  3  2  4  5  8  9  7</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/detect.html">detect</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/detect.html">detect_index</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p><code><a href="https://purrr.tidyverse.org/reference/head_while.html">head_while()</a></code> e <code><a href="https://purrr.tidyverse.org/reference/head_while.html">tail_while()</a></code> prendono elementi dall’inizio o dalla fine di un vettore mentre un predicato è vero:</p>
<div class="sourceCode" id="cb594"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/head_while.html">head_while</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10  6</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/head_while.html">tail_while</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8 9 7</span></span></code></pre></div>
</div>
<div id="ridurre-e-accumulare" class="section level3" number="21.9.2">
<h3>
<span class="header-section-number">21.9.2</span> Ridurre e accumulare<a class="anchor" aria-label="anchor" href="#ridurre-e-accumulare"><i class="fas fa-link"></i></a>
</h3>
<p>A volte si ha una lista complessa che si vuole ridurre ad una lista semplice applicando ripetutamente una funzione che riduce una coppia ad un singoletto. Questo è utile se si vuole applicare un verbo di dplyr a due tabelle a più tabelle. Per esempio, potreste avere una lista di frame di dati, e volete ridurla ad un singolo frame di dati unendo gli elementi insieme:</p>
<div class="sourceCode" id="cb595"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"John"</span>, age <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  sex <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"John"</span>, <span class="st">"Mary"</span><span class="op">)</span>, sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trt <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Mary"</span>, treatment <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">full_join</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = "name"</span></span>
<span><span class="co">#&gt; Joining, by = "name"</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   name    age sex   treatment</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 John     30 M     &lt;NA&gt;     </span></span>
<span><span class="co">#&gt; 2 Mary     NA F     A</span></span></code></pre></div>
<p>O forse avete una lista di vettori e volete trovare l’intersezione:</p>
<div class="sourceCode" id="cb596"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">intersect</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  1  3 10</span></span></code></pre></div>
<p>La funzione <code><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce()</a></code> prende una funzione “binaria” (cioè una funzione con due input primari), e la applica ripetutamente ad una lista finché non rimane un solo elemento.</p>
<p>La funzione <code><a href="https://purrr.tidyverse.org/reference/accumulate.html">accumulate()</a></code> è simile, ma mantiene tutti i risultati intermedi. Potreste usarla per implementare una somma cumulativa:</p>
<div class="sourceCode" id="cb597"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt;  [1]  7  5 10  9  8  3  1  4  2  6</span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/accumulate.html">accumulate</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  7 12 22 31 39 42 43 47 49 55</span></span></code></pre></div>
</div>
<div id="esercizi-62" class="section level3" number="21.9.3">
<h3>
<span class="header-section-number">21.9.3</span> Esercizi<a class="anchor" aria-label="anchor" href="#esercizi-62"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Implementate la vostra versione di <code><a href="https://purrr.tidyverse.org/reference/every.html">every()</a></code> usando un ciclo for. Confrontatela con <code><a href="https://purrr.tidyverse.org/reference/every.html">purrr::every()</a></code>. Cosa fa la versione di Purrr che la vostra non fa?</p></li>
<li><p>Create un <code>col_summary()</code> migliorato che applica una funzione di riepilogo ad ogni colonna numerica in un frame di dati.</p></li>
<li>
<p>Un possibile equivalente in R di base di <code>col_summary()</code> è:</p>
<div class="sourceCode" id="cb598"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_sum3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">is_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">is.numeric</span><span class="op">)</span></span>
<span>  <span class="va">df_num</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="va">is_num</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">df_num</span>, <span class="va">f</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Ma ha una serie di bug come illustrato con i seguenti input:</p>
<div class="sourceCode" id="cb599"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, </span>
<span>  y <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">1</span>,</span>
<span>  z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># OK</span></span>
<span><span class="fu">col_sum3</span><span class="op">(</span><span class="va">df</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co"># Ha problemi: non sempre restituisce un vettore numerico</span></span>
<span><span class="fu">col_sum3</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="fu">col_sum3</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="fu">col_sum3</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span>, <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<p>Cosa causa i bug?</p>
</li>
</ol>
</div>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="vettori.html"><span class="header-section-number">20</span> Vettori</a></div>
<div class="next"><a href="model-intro.html"><span class="header-section-number">22</span> Introduzione</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#iterazioni"><span class="header-section-number">21</span> Iterazioni</a></li>
<li>
<a class="nav-link" href="#introduzione-14"><span class="header-section-number">21.1</span> Introduzione</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#prerequisiti-14"><span class="header-section-number">21.1.1</span> Prerequisiti</a></li></ul>
</li>
<li>
<a class="nav-link" href="#cicli-for"><span class="header-section-number">21.2</span> Cicli for</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#esercizi-58"><span class="header-section-number">21.2.1</span> Esercizi</a></li></ul>
</li>
<li>
<a class="nav-link" href="#variazioni-del-ciclo-for"><span class="header-section-number">21.3</span> Variazioni del ciclo for</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#modifica-di-un-oggetto-esistente"><span class="header-section-number">21.3.1</span> Modifica di un oggetto esistente</a></li>
<li><a class="nav-link" href="#modelli-di-looping"><span class="header-section-number">21.3.2</span> Modelli di looping</a></li>
<li><a class="nav-link" href="#lunghezza-di-uscita-sconosciuta"><span class="header-section-number">21.3.3</span> Lunghezza di uscita sconosciuta</a></li>
<li><a class="nav-link" href="#lunghezza-della-sequenza-sconosciuta"><span class="header-section-number">21.3.4</span> Lunghezza della sequenza sconosciuta</a></li>
<li><a class="nav-link" href="#esercizi-59"><span class="header-section-number">21.3.5</span> Esercizi</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#cicli-for-vs.-funzionali"><span class="header-section-number">21.4</span> Cicli for vs. funzionali</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#esercizi-60"><span class="header-section-number">21.4.1</span> Esercizi</a></li></ul>
</li>
<li>
<a class="nav-link" href="#le-funzioni-map"><span class="header-section-number">21.5</span> Le funzioni map</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#scorciatoie"><span class="header-section-number">21.5.1</span> Scorciatoie</a></li>
<li><a class="nav-link" href="#base-r"><span class="header-section-number">21.5.2</span> Base R</a></li>
<li><a class="nav-link" href="#esercizi-61"><span class="header-section-number">21.5.3</span> Esercizi</a></li>
</ul>
</li>
<li><a class="nav-link" href="#affrontare-il-fallimento"><span class="header-section-number">21.6</span> Affrontare il fallimento</a></li>
<li>
<a class="nav-link" href="#map-su-pi%C3%B9-argomenti"><span class="header-section-number">21.7</span> Map su più argomenti</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#invocare-diverse-funzioni"><span class="header-section-number">21.7.1</span> Invocare diverse funzioni</a></li></ul>
</li>
<li><a class="nav-link" href="#walk"><span class="header-section-number">21.8</span> Walk</a></li>
<li>
<a class="nav-link" href="#altri-modelli-di-cicli-for"><span class="header-section-number">21.9</span> Altri modelli di cicli for</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#funzioni-predicate"><span class="header-section-number">21.9.1</span> Funzioni predicate</a></li>
<li><a class="nav-link" href="#ridurre-e-accumulare"><span class="header-section-number">21.9.2</span> Ridurre e accumulare</a></li>
<li><a class="nav-link" href="#esercizi-62"><span class="header-section-number">21.9.3</span> Esercizi</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/lucavd/r4ds_ita_1st_ed/blob/master/iteration.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/lucavd/r4ds_ita_1st_ed/edit/master/iteration.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Data Science - edizione italiana</strong>" was written by Hadley Wickham e Garrett Grolemund. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
